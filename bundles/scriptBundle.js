/*! For license information please see scriptBundle.js.LICENSE.txt */
(()=>{"use strict";var e={203:(e,t,n)=>{n.d(t,{x:()=>Ju});var i,s=n(503),r=n(389),o=n(463),a=n(333),c=n(444),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},h={},l=l||{},d=u||self;function f(){}function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function v(e,t,n){return e.call.apply(e.bind,arguments)}function w(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function E(e,t,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:w).apply(null,arguments)}function I(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function T(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function b(){this.s=this.s,this.o=this.o}var _={};b.prototype.s=!1,b.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,m)&&e[m]||(e[m]=++y)}(this);delete _[e]}},b.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},k=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const i=e.length,s="string"==typeof e?e.split(""):e;for(let r=0;r<i;r++)r in s&&t.call(n,s[r],r,e)};function C(e){return Array.prototype.concat.apply([],arguments)}function A(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function N(e){return/^[\s\xa0]*$/.test(e)}var R,D=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function O(e,t){return-1!=e.indexOf(t)}function L(e,t){return e<t?-1:e>t?1:0}e:{var P=d.navigator;if(P){var M=P.userAgent;if(M){R=M;break e}}R=""}function x(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function U(e){const t={};for(const n in e)t[n]=e[n];return t}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<V.length;t++)n=V[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function B(e){return B[" "](e),e}B[" "]=f;var j,q,K=O(R,"Opera"),z=O(R,"Trident")||O(R,"MSIE"),H=O(R,"Edge"),$=H||z,G=O(R,"Gecko")&&!(O(R.toLowerCase(),"webkit")&&!O(R,"Edge"))&&!(O(R,"Trident")||O(R,"MSIE"))&&!O(R,"Edge"),W=O(R.toLowerCase(),"webkit")&&!O(R,"Edge");function X(){var e=d.document;return e?e.documentMode:void 0}e:{var Y="",Q=(q=R,G?/rv:([^\);]+)(\)|;)/.exec(q):H?/Edge\/([\d\.]+)/.exec(q):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(q):W?/WebKit\/(\S+)/.exec(q):K?/(?:Version)[ \/]?(\S+)/.exec(q):void 0);if(Q&&(Y=Q?Q[1]:""),z){var J=X();if(null!=J&&J>parseFloat(Y)){j=String(J);break e}}j=Y}var Z,ee={};function te(){return e=ee,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=D(String(j)).split("."),n=D("9").split("."),i=Math.max(t.length,n.length);for(let o=0;0==e&&o<i;o++){var s=t[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;e=L(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||L(0==s[2].length,0==r[2].length)||L(s[2],r[2]),s=s[3],r=r[3]}while(0==e)}return 0<=e}();var e}d.document&&z?Z=X()||parseInt(j,10)||void 0:Z=void 0;var ne=Z,ie=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{d.addEventListener("test",f,t),d.removeEventListener("test",f,t)}catch(e){}return e}();function se(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function re(e,t){if(se.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(G){e:{try{B(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&re.Z.h.call(this)}}se.prototype.h=function(){this.defaultPrevented=!0},T(re,se);var oe={2:"touch",3:"pen",4:"mouse"};re.prototype.h=function(){re.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),ce=0;function ue(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ia=s,this.key=++ce,this.ca=this.fa=!1}function he(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function le(e){this.src=e,this.g={},this.h=0}function de(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=S(s,t);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(he(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function fe(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.ca&&r.listener==t&&r.capture==!!n&&r.ia==i)return s}return-1}le.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=fe(e,t,i,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ue(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var pe="closure_lm_"+(1e6*Math.random()|0),ge={};function me(e,t,n,i,s){if(i&&i.once)return ve(e,t,n,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)me(e,t[r],n,i,s);return null}return n=Se(n),e&&e[ae]?e.N(t,n,g(i)?!!i.capture:!!i,s):ye(e,t,n,!1,i,s)}function ye(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var o=g(s)?!!s.capture:!!s,a=be(e);if(a||(e[pe]=a=new le(e)),(n=a.add(t,n,i,o,r)).proxy)return n;if(i=function(){var e=Te;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)ie||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(Ie(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function ve(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)ve(e,t[r],n,i,s);return null}return n=Se(n),e&&e[ae]?e.O(t,n,g(i)?!!i.capture:!!i,s):ye(e,t,n,!0,i,s)}function we(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)we(e,t[r],n,i,s);else i=g(i)?!!i.capture:!!i,n=Se(n),e&&e[ae]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=fe(r=e.g[t],n,i,s))&&(he(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=be(e))&&(t=e.g[t.toString()],e=-1,t&&(e=fe(t,n,i,s)),(n=-1<e?t[e]:null)&&Ee(n))}function Ee(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[ae])de(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Ie(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=be(t))?(de(n,e),0==n.h&&(n.src=null,t[pe]=null)):he(e)}}}function Ie(e){return e in ge?ge[e]:ge[e]="on"+e}function Te(e,t){if(e.ca)e=!0;else{t=new re(t,this);var n=e.listener,i=e.ia||e.src;e.fa&&Ee(e),e=n.call(i,t)}return e}function be(e){return(e=e[pe])instanceof le?e:null}var _e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Se(e){return"function"==typeof e?e:(e[_e]||(e[_e]=function(t){return e.handleEvent(t)}),e[_e])}function ke(){b.call(this),this.i=new le(this),this.P=this,this.I=null}function Ce(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"==typeof t)t=new se(t,e);else if(t instanceof se)t.target=t.target||e;else{var s=t;F(t=new se(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];s=Ae(o,i,!0,t)&&s}if(s=Ae(o=t.g=e,i,!0,t)&&s,s=Ae(o,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=Ae(o=t.g=n[r],i,!1,t)&&s}function Ae(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&de(e.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}T(ke,b),ke.prototype[ae]=!0,ke.prototype.removeEventListener=function(e,t,n,i){we(this,e,t,n,i)},ke.prototype.M=function(){if(ke.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)he(n[i]);delete t.g[e],t.h--}}this.I=null},ke.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ke.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Ne=d.JSON.stringify;function Re(){var e=Ue;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var De,Oe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Le),(e=>e.reset()));class Le{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Pe(e){d.setTimeout((()=>{throw e}),0)}function Me(e,t){De||function(){var e=d.Promise.resolve(void 0);De=function(){e.then(Ve)}}(),xe||(De(),xe=!0),Ue.add(e,t)}var xe=!1,Ue=new class{constructor(){this.h=this.g=null}add(e,t){const n=Oe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Ve(){for(var e;e=Re();){try{e.h.call(e.g)}catch(e){Pe(e)}var t=Oe;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}xe=!1}function Fe(e,t){ke.call(this),this.h=e||1,this.g=t||d,this.j=E(this.kb,this),this.l=Date.now()}function Be(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function je(e,t,n){if("function"==typeof e)n&&(e=E(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=E(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function qe(e){e.g=je((()=>{e.g=null,e.i&&(e.i=!1,qe(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}T(Fe,ke),(i=Fe.prototype).da=!1,i.S=null,i.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ce(this,"tick"),this.da&&(Be(this),this.start()))}},i.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},i.M=function(){Fe.Z.M.call(this),Be(this),delete this.g};class Ke extends b{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:qe(this)}M(){super.M(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ze(e){b.call(this),this.h=e,this.g={}}T(ze,b);var He=[];function $e(e,t,n,i){Array.isArray(n)||(n&&(He[0]=n.toString()),n=He);for(var s=0;s<n.length;s++){var r=me(t,n[s],i||e.handleEvent,!1,e.h||e);if(!r)break;e.g[r.key]=r}}function Ge(e){x(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ee(e)}),e),e.g={}}function We(){this.g=!0}function Xe(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return Ne(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}ze.prototype.M=function(){ze.Z.M.call(this),Ge(this)},ze.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Aa=function(){this.g=!1},We.prototype.info=function(){};var Ye={},Qe=null;function Je(){return Qe=Qe||new ke}function Ze(e){se.call(this,Ye.Ma,e)}function et(e){const t=Je();Ce(t,new Ze(t,e))}function tt(e,t){se.call(this,Ye.STAT_EVENT,e),this.stat=t}function nt(e){const t=Je();Ce(t,new tt(t,e))}function it(e,t){se.call(this,Ye.Na,e),this.size=t}function st(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}Ye.Ma="serverreachability",T(Ze,se),Ye.STAT_EVENT="statevent",T(tt,se),Ye.Na="timingevent",T(it,se);var rt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ot={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function at(){}function ct(e){return e.h||(e.h=e.i())}function ut(){}at.prototype.h=null;var ht,lt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function dt(){se.call(this,"d")}function ft(){se.call(this,"c")}function pt(){}function gt(e,t,n,i){this.l=e,this.j=t,this.m=n,this.X=i||1,this.V=new ze(this),this.P=yt,e=$?125:void 0,this.W=new Fe(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new mt}function mt(){this.i=null,this.g="",this.h=!1}T(dt,se),T(ft,se),T(pt,at),pt.prototype.g=function(){return new XMLHttpRequest},pt.prototype.i=function(){return{}},ht=new pt;var yt=45e3,vt={},wt={};function Et(e,t,n){e.K=1,e.v=Kt(Ut(t)),e.s=n,e.U=!0,It(e,null)}function It(e,t){e.F=Date.now(),St(e),e.A=Ut(e.v);var n=e.A,i=e.X;Array.isArray(i)||(i=[String(i)]),nn(n.h,"t",i),e.C=0,n=e.l.H,e.h=new mt,e.g=ii(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Ke(E(e.Ia,e,e.g),e.O)),$e(e.V,e.g,"readystatechange",e.gb),t=e.H?U(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),et(1),function(e,t,n,i,s,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Tt(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function bt(e,t,n){let i,s=!0;for(;!e.I&&e.C<n.length;){if(i=_t(e,n),i==wt){4==t&&(e.o=4,nt(14),s=!1),Xe(e.j,e.m,null,"[Incomplete Response]");break}if(i==vt){e.o=4,nt(15),Xe(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}Xe(e.j,e.m,i,null),Rt(e,i)}Tt(e)&&i!=wt&&i!=vt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(t),t.L=!0,nt(11))):(Xe(e.j,e.m,n,"[Invalid Chunked Response]"),Nt(e),At(e))}function _t(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?wt:(n=Number(t.substring(n,i)),isNaN(n)?vt:(i+=1)+n>t.length?wt:(t=t.substr(i,n),e.C=i+n,t))}function St(e){e.Y=Date.now()+e.P,kt(e,e.P)}function kt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=st(E(e.eb,e),t)}function Ct(e){e.B&&(d.clearTimeout(e.B),e.B=null)}function At(e){0==e.l.G||e.I||Jn(e.l,e)}function Nt(e){Ct(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Be(e.W),Ge(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Rt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||un(n.i,e)))if(n.I=e.N,!e.J&&un(n.i,e)&&3==n.G){try{var i=n.Ca.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Qn(n),Bn(n)}Wn(n),nt(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=st(E(n.ab,n),6e3));if(1>=cn(n.i)&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else ei(n,11)}else if((e.J||n.g==e)&&Qn(n),!N(t))for(s=n.Ca.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.i;!r.g&&(O(e,"spdy")||O(e,"quic")||O(e,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(hn(r,r.h),r.h=null))}if(i.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.sa=e,qt(i.F,i.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((i=n).oa=ni(i,i.H?i.la:null,i.W),o.J){ln(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(Ct(a),St(a)),i.g=o}else Gn(i);0<n.l.length&&Kn(n)}else"stop"!=u[0]&&"close"!=u[0]||ei(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ei(n,7):Fn(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}et(4)}catch(e){}}function Dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)k(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(p(e)||"string"==typeof e){n=[];for(var i=e.length,s=0;s<i;s++)n.push(s)}else for(s in n=[],i=0,e)n[i++]=s;i=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length;for(var r=0;r<s;r++)t.call(void 0,i[r],n&&n[r],e)}}function Ot(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(e)if(e instanceof Ot)for(n=e.T(),i=0;i<n.length;i++)this.set(n[i],e.get(n[i]));else for(i in e)this.set(i,e[i])}function Lt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var i=e.g[t];Pt(e.h,i)&&(e.g[n++]=i),t++}e.g.length=n}if(e.i!=e.g.length){var s={};for(n=t=0;t<e.g.length;)Pt(s,i=e.g[t])||(e.g[n++]=i,s[i]=1),t++;e.g.length=n}}function Pt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(i=gt.prototype).setTimeout=function(e){this.P=e},i.gb=function(e){e=e.target;const t=this.L;t&&3==Pn(e)?t.l():this.Ia(e)},i.Ia=function(e){try{if(e==this.g)e:{const h=Pn(this.g);var t=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||$||this.g&&(this.h.h||this.g.ga()||Mn(this.g)))){this.I||4!=h||7==t||et(8==t||0>=l?3:2),Ct(this);var n=this.g.ba();this.N=n;t:if(Tt(this)){var i=Mn(this.g);e="";var s=i.length,r=4==Pn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nt(this),At(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:r&&t==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,i,s,r,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,nt(12),Nt(this),At(this);break e}Xe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Rt(this,n)}this.U?(bt(this,h,o),$&&this.i&&3==h&&($e(this.V,this.W,"tick",this.fb),this.W.start())):(Xe(this.j,this.m,o,null),Rt(this,o)),4==h&&Nt(this),this.i&&!this.I&&(4==h?Jn(this.l,this):(this.i=!1,St(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Nt(this),At(this)}}}catch(e){}},i.fb=function(){if(this.g){var e=Pn(this.g),t=this.g.ga();this.C<t.length&&(Ct(this),bt(this,e,t),this.i&&4!=e&&St(this))}},i.cancel=function(){this.I=!0,Nt(this)},i.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(et(3),nt(17)),Nt(this),this.o=2,At(this)):kt(this,this.Y-e)},(i=Ot.prototype).R=function(){Lt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},i.T=function(){return Lt(this),this.g.concat()},i.get=function(e,t){return Pt(this.h,e)?this.h[e]:t},i.set=function(e,t){Pt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},i.forEach=function(e,t){for(var n=this.T(),i=0;i<n.length;i++){var s=n[i],r=this.get(s);e.call(t,r,s,this)}};var Mt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function xt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof xt){this.g=void 0!==t?t:e.g,Vt(this,e.j),this.s=e.s,Ft(this,e.i),Bt(this,e.m),this.l=e.l,t=e.h;var n=new Jt;n.i=t.i,t.g&&(n.g=new Ot(t.g),n.h=t.h),jt(this,n),this.o=e.o}else e&&(n=String(e).match(Mt))?(this.g=!!t,Vt(this,n[1]||"",!0),this.s=zt(n[2]||""),Ft(this,n[3]||"",!0),Bt(this,n[4]),this.l=zt(n[5]||"",!0),jt(this,n[6]||"",!0),this.o=zt(n[7]||"")):(this.g=!!t,this.h=new Jt(null,this.g))}function Ut(e){return new xt(e)}function Vt(e,t,n){e.j=n?zt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ft(e,t,n){e.i=n?zt(t,!0):t}function Bt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function jt(e,t,n){t instanceof Jt?(e.h=t,function(e,t){t&&!e.j&&(Zt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(en(this,t),nn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=Ht(t,Yt)),e.h=new Jt(t,e.g))}function qt(e,t,n){e.h.set(t,n)}function Kt(e){return qt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function zt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ht(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,$t),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function $t(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}xt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ht(t,Gt,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ht(t,Gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ht(n,"/"==n.charAt(0)?Xt:Wt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ht(n,Qt)),e.join("")};var Gt=/[#\/\?@]/g,Wt=/[#\?:]/g,Xt=/[#\?]/g,Yt=/[#\?@]/g,Qt=/#/g;function Jt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Zt(e){e.g||(e.g=new Ot,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function en(e,t){Zt(e),t=sn(e,t),Pt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Pt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Lt(e)))}function tn(e,t){return Zt(e),t=sn(e,t),Pt(e.g.h,t)}function nn(e,t,n){en(e,t),0<n.length&&(e.i=null,e.g.set(sn(e,t),A(n)),e.h+=n.length)}function sn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function rn(e){this.l=e||on,e=d.PerformanceNavigationTiming?0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(d.g&&d.g.Ea&&d.g.Ea()&&d.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(i=Jt.prototype).add=function(e,t){Zt(this),this.i=null,e=sn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},i.forEach=function(e,t){Zt(this),this.g.forEach((function(n,i){k(n,(function(n){e.call(t,n,i,this)}),this)}),this)},i.T=function(){Zt(this);for(var e=this.g.R(),t=this.g.T(),n=[],i=0;i<t.length;i++)for(var s=e[i],r=0;r<s.length;r++)n.push(t[i]);return n},i.R=function(e){Zt(this);var t=[];if("string"==typeof e)tn(this,e)&&(t=C(t,this.g.get(sn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=C(t,e[n])}return t},i.set=function(e,t){return Zt(this),this.i=null,tn(this,e=sn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},i.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},i.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var i=t[n],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;""!==i[r]&&(o+="="+encodeURIComponent(String(i[r]))),e.push(o)}}return this.i=e.join("&")};var on=10;function an(e){return!!e.h||!!e.g&&e.g.size>=e.j}function cn(e){return e.h?1:e.g?e.g.size:0}function un(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function hn(e,t){e.g?e.g.add(t):e.h=t}function ln(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return A(e.i)}function fn(){}function pn(){this.g=new fn}function gn(e,t,n){const i=n||"";try{Dt(e,(function(e,n){let s=e;g(e)&&(s=Ne(e)),t.push(i+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function mn(e,t,n,i,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(i)}catch(e){}}function yn(e){this.l=e.$b||null,this.j=e.ib||!1}function vn(e,t){ke.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=wn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rn.prototype.cancel=function(){if(this.i=dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fn.prototype.stringify=function(e){return d.JSON.stringify(e,void 0)},fn.prototype.parse=function(e){return d.JSON.parse(e,void 0)},T(yn,at),yn.prototype.g=function(){return new vn(this.l,this.j)},yn.prototype.i=function(e){return function(){return e}}({}),T(vn,ke);var wn=0;function En(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function In(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Tn(e)}function Tn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(i=vn.prototype).open=function(e,t){if(this.readyState!=wn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Tn(this)},i.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||d).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},i.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,In(this)),this.readyState=wn},i.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Tn(this)),this.g&&(this.readyState=3,Tn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;En(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},i.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?In(this):Tn(this),3==this.readyState&&En(this)}},i.Ua=function(e){this.g&&(this.response=this.responseText=e,In(this))},i.Ta=function(e){this.g&&(this.response=e,In(this))},i.ha=function(){this.g&&In(this)},i.setRequestHeader=function(e,t){this.v.append(e,t)},i.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(vn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var bn=d.JSON.parse;function _n(e){ke.call(this),this.headers=new Ot,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Sn,this.K=this.L=!1}T(_n,ke);var Sn="",kn=/^https?$/i,Cn=["POST","PUT"];function An(e){return"content-type"==e.toLowerCase()}function Nn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Rn(e),On(e)}function Rn(e){e.D||(e.D=!0,Ce(e,"complete"),Ce(e,"error"))}function Dn(e){if(e.h&&void 0!==l&&(!e.C[1]||4!=Pn(e)||2!=e.ba()))if(e.v&&4==Pn(e))je(e.Fa,0,e);else if(Ce(e,"readystatechange"),4==Pn(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===a){var s=String(e.H).match(Mt)[1]||null;if(!s&&d.self&&d.self.location){var r=d.self.location.protocol;s=r.substr(0,r.length-1)}i=!kn.test(s?s.toLowerCase():"")}n=i}if(n)Ce(e,"complete"),Ce(e,"success");else{e.m=6;try{var o=2<Pn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.ba()+"]",Rn(e)}}finally{On(e)}}}function On(e,t){if(e.g){Ln(e);const n=e.g,i=e.C[0]?f:null;e.g=null,e.C=null,t||Ce(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function Ln(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function Pn(e){return e.g?e.g.readyState:0}function Mn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Sn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function xn(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=function(e){let t="";return x(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):qt(e,t,n))}function Un(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Vn(e){this.za=0,this.l=[],this.h=new We,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Un("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Un("baseRetryDelayMs",5e3,e),this.$a=Un("retryDelaySeedMs",1e4,e),this.Ya=Un("forwardChannelMaxRetries",2,e),this.ra=Un("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new rn(e&&e.concurrentRequestLimit),this.Ca=new pn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Fn(e){if(jn(e),3==e.G){var t=e.V++,n=Ut(e.F);qt(n,"SID",e.J),qt(n,"RID",t),qt(n,"TYPE","terminate"),Hn(e,n),(t=new gt(e,e.h,t,void 0)).K=2,t.v=Kt(Ut(n)),n=!1,d.navigator&&d.navigator.sendBeacon&&(n=d.navigator.sendBeacon(t.v.toString(),"")),!n&&d.Image&&((new Image).src=t.v,n=!0),n||(t.g=ii(t.l,null),t.g.ea(t.v)),t.F=Date.now(),St(t)}ti(e)}function Bn(e){e.g&&(Xn(e),e.g.cancel(),e.g=null)}function jn(e){Bn(e),e.u&&(d.clearTimeout(e.u),e.u=null),Qn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&d.clearTimeout(e.m),e.m=null)}function qn(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&Kn(e)}function Kn(e){an(e.i)||e.m||(e.m=!0,Me(e.Ha,e),e.C=0)}function zn(e,t){var n;n=t?t.m:e.V++;const i=Ut(e.F);qt(i,"SID",e.J),qt(i,"RID",n),qt(i,"AID",e.U),Hn(e,i),e.o&&e.s&&xn(i,e.o,e.s),n=new gt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=$n(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hn(e.i,n),Et(n,i,t)}function Hn(e,t){e.j&&Dt({},(function(e,n){qt(t,n,e)}))}function $n(e,t,n){n=Math.min(e.l.length,n);var i=e.j?E(e.j.Oa,e.j,e):null;e:{var s=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=t,0>n)t=Math.max(0,s[o].h-100),r=!1;else try{gn(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(r){i=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,i}function Gn(e){e.g||e.u||(e.Y=1,Me(e.Ga,e),e.A=0)}function Wn(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=st(E(e.Ga,e),Zn(e,e.A)),e.A++,0))}function Xn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function Yn(e){e.g=new gt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Ut(e.oa);qt(t,"RID","rpc"),qt(t,"SID",e.J),qt(t,"CI",e.N?"0":"1"),qt(t,"AID",e.U),Hn(e,t),qt(t,"TYPE","xmlhttp"),e.o&&e.s&&xn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Kt(Ut(t)),n.s=null,n.U=!0,It(n,e)}function Qn(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function Jn(e,t){var n=null;if(e.g==t){Qn(e),Xn(e),e.g=null;var i=2}else{if(!un(e.i,t))return;n=t.D,ln(e.i,t),i=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;Ce(i=Je(),new it(i,n,t,s)),Kn(e)}else Gn(e);else if(3==(s=t.o)||0==s&&0<e.I||!(1==i&&function(e,t){return!(cn(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=st(E(e.Ha,e,t),Zn(e,e.C)),e.C++,0)))}(e,t)||2==i&&Wn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:ei(e,5);break;case 4:ei(e,10);break;case 3:ei(e,6);break;default:ei(e,2)}}function Zn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function ei(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var i=E(e.jb,e);n||(n=new xt("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Vt(n,"https"),Kt(n)),function(e,t){const n=new We;if(d.Image){const i=new Image;i.onload=I(mn,n,i,"TestLoadImage: loaded",!0,t),i.onerror=I(mn,n,i,"TestLoadImage: error",!1,t),i.onabort=I(mn,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=I(mn,n,i,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else nt(2);e.G=0,e.j&&e.j.va(t),ti(e),jn(e)}function ti(e){e.G=0,e.I=-1,e.j&&(0==dn(e.i).length&&0==e.l.length||(e.i.i.length=0,A(e.l),e.l.length=0),e.j.ua())}function ni(e,t,n){let i=function(e){return e instanceof xt?Ut(e):new xt(e,void 0)}(n);if(""!=i.i)t&&Ft(i,t+"."+i.i),Bt(i,i.m);else{const e=d.location;i=function(e,t,n,i){var s=new xt(null,void 0);return e&&Vt(s,e),t&&Ft(s,t),n&&Bt(s,n),i&&(s.l=i),s}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&x(e.aa,(function(e,t){qt(i,t,e)})),t=e.D,n=e.sa,t&&n&&qt(i,t,n),qt(i,"VER",e.ma),Hn(e,i),i}function ii(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new _n(new yn({ib:!0})):new _n(e.qa)).L=e.H,t}function si(){}function ri(){if(z&&!(10<=Number(ne)))throw Error("Environmental error: no available transport.")}function oi(e,t){ke.call(this),this.g=new Vn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!N(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ui(this)}function ai(e){dt.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ci(){ft.call(this),this.status=1}function ui(e){this.g=e}(i=_n.prototype).ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ht.g(),this.C=this.u?ct(this.u):ct(ht),this.g.onreadystatechange=E(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Nn(this,e)}e=n||"";const s=new Ot(this.headers);i&&Dt(i,(function(e,t){s.set(t,e)})),i=function(e){e:{var t=An;const n=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<n;s++)if(s in i&&t.call(void 0,i[s],s,e)){t=s;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),n=d.FormData&&e instanceof d.FormData,!(0<=S(Cn,t))||i||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ln(this),0<this.B&&((this.K=function(e){return z&&te()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=E(this.pa,this)):this.A=je(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Nn(this,e)}},i.pa=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ce(this,"timeout"),this.abort(8))},i.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ce(this,"complete"),Ce(this,"abort"),On(this))},i.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),On(this,!0)),_n.Z.M.call(this)},i.Fa=function(){this.s||(this.F||this.v||this.l?Dn(this):this.cb())},i.cb=function(){Dn(this)},i.ba=function(){try{return 2<Pn(this)?this.g.status:-1}catch(e){return-1}},i.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},i.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),bn(t)}},i.Da=function(){return this.m},i.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(i=Vn.prototype).ma=8,i.G=1,i.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},i.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new gt(this,this.h,e,void 0);let r=this.s;if(this.P&&(r?(r=U(r),F(r,this.P)):r=this.P),null===this.o&&(s.H=r),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=$n(this,s,t),qt(n=Ut(this.F),"RID",e),qt(n,"CVER",22),this.D&&qt(n,"X-HTTP-Session-Id",this.D),Hn(this,n),this.o&&r&&xn(n,this.o,r),hn(this.i,s),this.Ra&&qt(n,"TYPE","init"),this.ja?(qt(n,"$req",t),qt(n,"SID","null"),s.$=!0,Et(s,n,null)):Et(s,n,t),this.G=2}}else 3==this.G&&(e?zn(this,e):0==this.l.length||an(this.i)||zn(this))},i.Ga=function(){if(this.u=null,Yn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=st(E(this.bb,this),e)}},i.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,nt(10),Bn(this),Yn(this))},i.ab=function(){null!=this.v&&(this.v=null,Bn(this),Wn(this),nt(19))},i.jb=function(e){e?(this.h.info("Successfully pinged google.com"),nt(2)):(this.h.info("Failed to ping google.com"),nt(1))},(i=si.prototype).xa=function(){},i.wa=function(){},i.va=function(){},i.ua=function(){},i.Oa=function(){},ri.prototype.g=function(e,t){return new oi(e,t)},T(oi,ke),oi.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Me(E(e.hb,e,t))),nt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=ni(e,null,e.W),Kn(e)},oi.prototype.close=function(){Fn(this.g)},oi.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,qn(this.g,t)}else this.v?((t={}).__data__=Ne(e),qn(this.g,t)):qn(this.g,e)},oi.prototype.M=function(){this.g.j=null,delete this.j,Fn(this.g),delete this.g,oi.Z.M.call(this)},T(ai,dt),T(ci,ft),T(ui,si),ui.prototype.xa=function(){Ce(this.g,"a")},ui.prototype.wa=function(e){Ce(this.g,new ai(e))},ui.prototype.va=function(e){Ce(this.g,new ci(e))},ui.prototype.ua=function(){Ce(this.g,"b")},ri.prototype.createWebChannel=ri.prototype.g,oi.prototype.send=oi.prototype.u,oi.prototype.open=oi.prototype.m,oi.prototype.close=oi.prototype.close,rt.NO_ERROR=0,rt.TIMEOUT=8,rt.HTTP_ERROR=6,ot.COMPLETE="complete",ut.EventType=lt,lt.OPEN="a",lt.CLOSE="b",lt.ERROR="c",lt.MESSAGE="d",ke.prototype.listen=ke.prototype.N,_n.prototype.listenOnce=_n.prototype.O,_n.prototype.getLastError=_n.prototype.La,_n.prototype.getLastErrorCode=_n.prototype.Da,_n.prototype.getStatus=_n.prototype.ba,_n.prototype.getResponseJson=_n.prototype.Qa,_n.prototype.getResponseText=_n.prototype.ga,_n.prototype.send=_n.prototype.ea;var hi=h.createWebChannelTransport=function(){return new ri},li=h.getStatEventTarget=function(){return Je()},di=h.ErrorCode=rt,fi=h.EventType=ot,pi=h.Event=Ye,gi=h.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},mi=h.FetchXmlHttpFactory=yn,yi=h.WebChannel=ut,vi=h.XhrIo=_n;const wi="@firebase/firestore";class Ei{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ei.UNAUTHENTICATED=new Ei(null),Ei.GOOGLE_CREDENTIALS=new Ei("google-credentials-uid"),Ei.FIRST_PARTY=new Ei("first-party-uid"),Ei.MOCK_USER=new Ei("mock-user");let Ii="9.8.0";const Ti=new a.Yd("@firebase/firestore");function bi(){return Ti.logLevel}function _i(e,...t){if(Ti.logLevel<=a.in.DEBUG){const n=t.map(Ci);Ti.debug(`Firestore (${Ii}): ${e}`,...n)}}function Si(e,...t){if(Ti.logLevel<=a.in.ERROR){const n=t.map(Ci);Ti.error(`Firestore (${Ii}): ${e}`,...n)}}function ki(e,...t){if(Ti.logLevel<=a.in.WARN){const n=t.map(Ci);Ti.warn(`Firestore (${Ii}): ${e}`,...n)}}function Ci(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ai(e="Unexpected state"){const t=`FIRESTORE (${Ii}) INTERNAL ASSERTION FAILED: `+e;throw Si(t),new Error(t)}function Ni(e,t){e||Ai()}function Ri(e,t){return e}const Di={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Oi extends c.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Li{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Pi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Mi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ei.UNAUTHENTICATED)))}shutdown(){}}class xi{constructor(e){this.t=e,this.currentUser=Ei.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Li;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Li,e.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{_i("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(_i("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Li)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(_i("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ni("string"==typeof t.accessToken),new Pi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ni(null===e||"string"==typeof e),new Ei(e)}}class Ui{constructor(e,t,n){this.type="FirstParty",this.user=Ei.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Vi{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Ui(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Ei.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Fi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Bi{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&_i("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,_i("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{_i("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?i(e):_i("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ni("string"==typeof e.token),this.p=e.token,new Fi(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ji{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function qi(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}ji.A=-1;class Ki{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=qi(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function zi(e,t){return e<t?-1:e>t?1:0}function Hi(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}class $i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Oi(Di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Oi(Di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Oi(Di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Oi(Di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return $i.fromMillis(Date.now())}static fromDate(e){return $i.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new $i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?zi(this.nanoseconds,e.nanoseconds):zi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Gi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Gi(e)}static min(){return new Gi(new $i(0,0))}static max(){return new Gi(new $i(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Wi(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Xi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Yi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Qi{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ai(),void 0===n?n=e.length-t:n>e.length-t&&Ai(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Qi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qi?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),s=t.get(i);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ji extends Qi{construct(e,t,n){return new Ji(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Oi(Di.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ji(t)}static emptyPath(){return new Ji([])}}const Zi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class es extends Qi{construct(e,t,n){return new es(e,t,n)}static isValidIdentifier(e){return Zi.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),es.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new es(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new Oi(Di.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new Oi(Di.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Oi(Di.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new Oi(Di.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new es(t)}static emptyPath(){return new es([])}}class ts{constructor(e){this.fields=e,e.sort(es.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hi(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ns{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ns(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ns(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return zi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ns.EMPTY_BYTE_STRING=new ns("");const is=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ss(e){if(Ni(!!e),"string"==typeof e){let t=0;const n=is.exec(e);if(Ni(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:rs(e.seconds),nanos:rs(e.nanos)}}function rs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function os(e){return"string"==typeof e?ns.fromBase64String(e):ns.fromUint8Array(e)}function as(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function cs(e){const t=e.mapValue.fields.__previous_value__;return as(t)?cs(t):t}function us(e){const t=ss(e.mapValue.fields.__local_write_time__.timestampValue);return new $i(t.seconds,t.nanos)}class hs{constructor(e,t,n,i,s,r,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class ls{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ls("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ls&&e.projectId===this.projectId&&e.database===this.database}}function ds(e){return null==e}function fs(e){return 0===e&&1/e==-1/0}class ps{constructor(e){this.path=e}static fromPath(e){return new ps(Ji.fromString(e))}static fromName(e){return new ps(Ji.fromString(e).popFirst(5))}static empty(){return new ps(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ji.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ji.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ps(new Ji(e.slice()))}}const gs={fields:{__type__:{stringValue:"__max__"}}};function ms(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?as(e)?4:Ns(e)?9007199254740991:10:Ai()}function ys(e,t){if(e===t)return!0;const n=ms(e);if(n!==ms(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return us(e).isEqual(us(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=ss(e.timestampValue),i=ss(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return os(e.bytesValue).isEqual(os(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return rs(e.geoPointValue.latitude)===rs(t.geoPointValue.latitude)&&rs(e.geoPointValue.longitude)===rs(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return rs(e.integerValue)===rs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=rs(e.doubleValue),i=rs(t.doubleValue);return n===i?fs(n)===fs(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Hi(e.arrayValue.values||[],t.arrayValue.values||[],ys);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Wi(n)!==Wi(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!ys(n[e],i[e])))return!1;return!0}(e,t);default:return Ai()}}function vs(e,t){return void 0!==(e.values||[]).find((e=>ys(e,t)))}function ws(e,t){if(e===t)return 0;const n=ms(e),i=ms(t);if(n!==i)return zi(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return zi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=rs(e.integerValue||e.doubleValue),i=rs(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Es(e.timestampValue,t.timestampValue);case 4:return Es(us(e),us(t));case 5:return zi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=os(e),i=os(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=zi(n[e],i[e]);if(0!==t)return t}return zi(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=zi(rs(e.latitude),rs(t.latitude));return 0!==n?n:zi(rs(e.longitude),rs(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=ws(n[e],i[e]);if(t)return t}return zi(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===gs&&t===gs)return 0;if(e===gs)return 1;if(t===gs)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let e=0;e<i.length&&e<r.length;++e){const t=zi(i[e],r[e]);if(0!==t)return t;const o=ws(n[i[e]],s[r[e]]);if(0!==o)return o}return zi(i.length,r.length)}(e.mapValue,t.mapValue);default:throw Ai()}}function Es(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return zi(e,t);const n=ss(e),i=ss(t),s=zi(n.seconds,i.seconds);return 0!==s?s:zi(n.nanos,i.nanos)}function Is(e){return Ts(e)}function Ts(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ss(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?os(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ps.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Ts(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${Ts(e.fields[s])}`;return n+"}"}(e.mapValue):Ai();var t,n}function bs(e){return!!e&&"integerValue"in e}function _s(e){return!!e&&"arrayValue"in e}function Ss(e){return!!e&&"nullValue"in e}function ks(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Cs(e){return!!e&&"mapValue"in e}function As(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Xi(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=As(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=As(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ns(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Rs{constructor(e){this.value=e}static empty(){return new Rs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Cs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=As(t)}setAll(e){let t=es.emptyPath(),n={},i=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=As(e):i.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Cs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ys(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Cs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Xi(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Rs(As(this.value))}}function Ds(e){const t=[];return Xi(e.fields,((e,n)=>{const i=new es([e]);if(Cs(n)){const e=Ds(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new ts(t)}class Os{constructor(e,t,n,i,s,r){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.data=s,this.documentState=r}static newInvalidDocument(e){return new Os(e,0,Gi.min(),Gi.min(),Rs.empty(),0)}static newFoundDocument(e,t,n){return new Os(e,1,t,Gi.min(),n,0)}static newNoDocument(e,t){return new Os(e,2,t,Gi.min(),Rs.empty(),0)}static newUnknownDocument(e,t){return new Os(e,3,t,Gi.min(),Rs.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Os&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Os(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function Ls(e){return new Ps(e.readTime,e.key,-1)}class Ps{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ps(Gi.min(),ps.empty(),-1)}static max(){return new Ps(Gi.max(),ps.empty(),-1)}}function Ms(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ps.comparator(e.documentKey,t.documentKey),0!==n?n:zi(e.largestBatchId,t.largestBatchId))}class xs{constructor(e,t){this.comparator=e,this.root=t||Vs.EMPTY}insert(e,t){return new xs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vs.BLACK,null,null))}remove(e){return new xs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Us(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Us(this.root,e,this.comparator,!1)}getReverseIterator(){return new Us(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Us(this.root,e,this.comparator,!0)}}class Us{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vs{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Vs.RED,this.left=null!=i?i:Vs.EMPTY,this.right=null!=s?s:Vs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Vs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Vs.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ai();if(this.right.isRed())throw Ai();const e=this.left.check();if(e!==this.right.check())throw Ai();return e+(this.isRed()?0:1)}}Vs.EMPTY=null,Vs.RED=!0,Vs.BLACK=!1,Vs.EMPTY=new class{constructor(){this.size=0}get key(){throw Ai()}get value(){throw Ai()}get color(){throw Ai()}get left(){throw Ai()}get right(){throw Ai()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Vs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fs{constructor(e){this.comparator=e,this.data=new xs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bs(this.data.getIterator())}getIteratorFrom(e){return new Bs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Fs))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Fs(this.comparator);return t.data=e,t}}class Bs{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class js{constructor(e,t=null,n=[],i=[],s=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.P=null}}function qs(e,t=null,n=[],i=[],s=null,r=null,o=null){return new js(e,t,n,i,s,r,o)}function Ks(e){const t=Ri(e);if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+Is(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),ds(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Is(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Is(e))).join(",")),t.P=e}return t.P}function zs(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ir(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(n=e.filters[s],i=t.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!ys(n.value,i.value))return!1;var n,i;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rr(e.startAt,t.startAt)&&rr(e.endAt,t.endAt)}function Hs(e){return ps.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class $s extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.V(e,t,n):new Gs(e,t,n):"array-contains"===t?new Qs(e,n):"in"===t?new Js(e,n):"not-in"===t?new Zs(e,n):"array-contains-any"===t?new er(e,n):new $s(e,t,n)}static V(e,t,n){return"in"===t?new Ws(e,n):new Xs(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(ws(t,this.value)):null!==t&&ms(this.value)===ms(t)&&this.v(ws(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ai()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Gs extends $s{constructor(e,t,n){super(e,t,n),this.key=ps.fromName(n.referenceValue)}matches(e){const t=ps.comparator(e.key,this.key);return this.v(t)}}class Ws extends $s{constructor(e,t){super(e,"in",t),this.keys=Ys(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Xs extends $s{constructor(e,t){super(e,"not-in",t),this.keys=Ys(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ys(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ps.fromName(e.referenceValue)))}class Qs extends $s{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _s(t)&&vs(t.arrayValue,this.value)}}class Js extends $s{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&vs(this.value.arrayValue,t)}}class Zs extends $s{constructor(e,t){super(e,"not-in",t)}matches(e){if(vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!vs(this.value.arrayValue,t)}}class er extends $s{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_s(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>vs(this.value.arrayValue,e)))}}class tr{constructor(e,t){this.position=e,this.inclusive=t}}class nr{constructor(e,t="asc"){this.field=e,this.dir=t}}function ir(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function sr(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],o=e.position[s];if(i=r.field.isKeyField()?ps.comparator(ps.fromName(o.referenceValue),n.key):ws(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function rr(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ys(e.position[n],t.position[n]))return!1;return!0}class or{constructor(e,t=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function ar(e){return new or(e)}function cr(e){const t=Ri(e);if(null===t.D){t.D=[];const e=function(e){for(const t of e.filters)if(t.S())return t.field;return null}(t),n=function(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}(t);if(null!==e&&null===n)e.isKeyField()||t.D.push(new nr(e)),t.D.push(new nr(es.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.D.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.D.push(new nr(es.keyField(),e))}}}return t.D}function ur(e){const t=Ri(e);if(!t.C)if("F"===t.limitType)t.C=qs(t.path,t.collectionGroup,cr(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of cr(t)){const t="desc"===n.dir?"asc":"desc";e.push(new nr(n.field,t))}const n=t.endAt?new tr(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new tr(t.startAt.position,t.startAt.inclusive):null;t.C=qs(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t.C}function hr(e,t){return zs(ur(e),ur(t))&&e.limitType===t.limitType}function lr(e){return`${Ks(ur(e))}|lt:${e.limitType}`}function dr(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Is(t.value)}`;var t})).join(", ")}]`),ds(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Is(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Is(e))).join(",")),`Target(${t})`}(ur(e))}; limitType=${e.limitType})`}function fr(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ps.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=sr(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,cr(e),t)||e.endAt&&!function(e,t,n){const i=sr(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,cr(e),t))}(e,t)}function pr(e){return(t,n)=>{let i=!1;for(const s of cr(e)){const e=gr(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function gr(e,t,n){const i=e.field.isKeyField()?ps.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?ws(i,s):Ai()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return Ai()}}function mr(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fs(t)?"-0":t}}function yr(e){return{integerValue:""+e}}function vr(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!fs(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?yr(t):mr(e,t)}class wr{constructor(){this._=void 0}}function Er(e,t,n){return e instanceof br?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof _r?Sr(e,t):e instanceof kr?Cr(e,t):function(e,t){const n=Tr(e,t),i=Nr(n)+Nr(e.k);return bs(n)&&bs(e.k)?yr(i):mr(e.M,i)}(e,t)}function Ir(e,t,n){return e instanceof _r?Sr(e,t):e instanceof kr?Cr(e,t):n}function Tr(e,t){return e instanceof Ar?bs(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class br extends wr{}class _r extends wr{constructor(e){super(),this.elements=e}}function Sr(e,t){const n=Rr(t);for(const t of e.elements)n.some((e=>ys(e,t)))||n.push(t);return{arrayValue:{values:n}}}class kr extends wr{constructor(e){super(),this.elements=e}}function Cr(e,t){let n=Rr(t);for(const t of e.elements)n=n.filter((e=>!ys(e,t)));return{arrayValue:{values:n}}}class Ar extends wr{constructor(e,t){super(),this.M=e,this.k=t}}function Nr(e){return rs(e.integerValue||e.doubleValue)}function Rr(e){return _s(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Dr{constructor(e,t){this.version=e,this.transformResults=t}}class Or{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Or}static exists(e){return new Or(void 0,e)}static updateTime(e){return new Or(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lr(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Pr{}function Mr(e,t,n){e instanceof Br?function(e,t,n){const i=e.value.clone(),s=Kr(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof jr?function(e,t,n){if(!Lr(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Kr(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(qr(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function xr(e,t,n){e instanceof Br?function(e,t,n){if(!Lr(e.precondition,t))return;const i=e.value.clone(),s=zr(e.fieldTransforms,n,t);i.setAll(s),t.convertToFoundDocument(Fr(t),i).setHasLocalMutations()}(e,t,n):e instanceof jr?function(e,t,n){if(!Lr(e.precondition,t))return;const i=zr(e.fieldTransforms,n,t),s=t.data;s.setAll(qr(e)),s.setAll(i),t.convertToFoundDocument(Fr(t),s).setHasLocalMutations()}(e,t,n):function(e,t){Lr(e.precondition,t)&&t.convertToNoDocument(Gi.min())}(e,t)}function Ur(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=Tr(i.transform,e||null);null!=s&&(null==n&&(n=Rs.empty()),n.set(i.field,s))}return n||null}function Vr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Hi(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof _r&&t instanceof _r||e instanceof kr&&t instanceof kr?Hi(e.elements,t.elements,ys):e instanceof Ar&&t instanceof Ar?ys(e.k,t.k):e instanceof br&&t instanceof br}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Fr(e){return e.isFoundDocument()?e.version:Gi.min()}class Br extends Pr{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}}class jr extends Pr{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}}function qr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function Kr(e,t,n){const i=new Map;Ni(e.length===n.length);for(let s=0;s<n.length;s++){const r=e[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,Ir(o,a,n[s]))}return i}function zr(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,Er(e,r,t))}return i}class Hr extends Pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class $r extends Pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Gr{constructor(e){this.count=e}}var Wr,Xr;function Yr(e){if(void 0===e)return Si("GRPC error has no .code"),Di.UNKNOWN;switch(e){case Wr.OK:return Di.OK;case Wr.CANCELLED:return Di.CANCELLED;case Wr.UNKNOWN:return Di.UNKNOWN;case Wr.DEADLINE_EXCEEDED:return Di.DEADLINE_EXCEEDED;case Wr.RESOURCE_EXHAUSTED:return Di.RESOURCE_EXHAUSTED;case Wr.INTERNAL:return Di.INTERNAL;case Wr.UNAVAILABLE:return Di.UNAVAILABLE;case Wr.UNAUTHENTICATED:return Di.UNAUTHENTICATED;case Wr.INVALID_ARGUMENT:return Di.INVALID_ARGUMENT;case Wr.NOT_FOUND:return Di.NOT_FOUND;case Wr.ALREADY_EXISTS:return Di.ALREADY_EXISTS;case Wr.PERMISSION_DENIED:return Di.PERMISSION_DENIED;case Wr.FAILED_PRECONDITION:return Di.FAILED_PRECONDITION;case Wr.ABORTED:return Di.ABORTED;case Wr.OUT_OF_RANGE:return Di.OUT_OF_RANGE;case Wr.UNIMPLEMENTED:return Di.UNIMPLEMENTED;case Wr.DATA_LOSS:return Di.DATA_LOSS;default:return Ai()}}(Xr=Wr||(Wr={}))[Xr.OK=0]="OK",Xr[Xr.CANCELLED=1]="CANCELLED",Xr[Xr.UNKNOWN=2]="UNKNOWN",Xr[Xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xr[Xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xr[Xr.NOT_FOUND=5]="NOT_FOUND",Xr[Xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xr[Xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xr[Xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xr[Xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xr[Xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xr[Xr.ABORTED=10]="ABORTED",Xr[Xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xr[Xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xr[Xr.INTERNAL=13]="INTERNAL",Xr[Xr.UNAVAILABLE=14]="UNAVAILABLE",Xr[Xr.DATA_LOSS=15]="DATA_LOSS";class Qr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Xi(this.inner,((t,n)=>{for(const[t,i]of n)e(t,i)}))}isEmpty(){return Yi(this.inner)}size(){return this.innerSize}}const Jr=new xs(ps.comparator);function Zr(){return Jr}const eo=new xs(ps.comparator);function to(...e){let t=eo;for(const n of e)t=t.insert(n.key,n);return t}function no(){return new Qr((e=>e.toString()),((e,t)=>e.isEqual(t)))}const io=new xs(ps.comparator),so=new Fs(ps.comparator);function ro(...e){let t=so;for(const n of e)t=t.add(n);return t}const oo=new Fs(zi);function ao(){return oo}class co{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,uo.createSynthesizedTargetChangeForCurrentChange(e,t)),new co(Gi.min(),n,ao(),Zr(),ro())}}class uo{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new uo(ns.EMPTY_BYTE_STRING,t,ro(),ro(),ro())}}class ho{constructor(e,t,n,i){this.O=e,this.removedTargetIds=t,this.key=n,this.F=i}}class lo{constructor(e,t){this.targetId=e,this.$=t}}class fo{constructor(e,t,n=ns.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class po{constructor(){this.B=0,this.L=yo(),this.U=ns.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=ro(),t=ro(),n=ro();return this.L.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Ai()}})),new uo(this.U,this.q,e,t,n)}J(){this.K=!1,this.L=yo()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class go{constructor(e){this.nt=e,this.st=new Map,this.it=Zr(),this.rt=mo(),this.ot=new Fs(zi)}ut(e){for(const t of e.O)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ht(e){this.forEachTarget(e,(t=>{const n=this.lt(t);switch(e.state){case 0:this.ft(t)&&n.W(e.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(e.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(t);break;case 3:this.ft(t)&&(n.et(),n.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),n.W(e.resumeToken));break;default:Ai()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach(((e,n)=>{this.ft(n)&&t(n)}))}_t(e){const t=e.targetId,n=e.$.count,i=this.wt(t);if(i){const e=i.target;if(Hs(e))if(0===n){const n=new ps(e.path);this.ct(t,n,Os.newNoDocument(n,Gi.min()))}else Ni(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach(((n,i)=>{const s=this.wt(i);if(s){if(n.current&&Hs(s.target)){const t=new ps(s.target.path);null!==this.it.get(t)||this.It(i,t)||this.ct(i,t,Os.newNoDocument(t,e))}n.j&&(t.set(i,n.H()),n.J())}}));let n=ro();this.rt.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.it.forEach(((t,n)=>n.setReadTime(e)));const i=new co(e,t,this.ot,this.it,n);return this.it=Zr(),this.rt=mo(),this.ot=new Fs(zi),i}at(e,t){if(!this.ft(e))return;const n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,n){if(!this.ft(e))return;const i=this.lt(e);this.It(e,t)?i.Y(t,1):i.X(t),this.rt=this.rt.insert(t,this.Tt(t).delete(e)),n&&(this.it=this.it.insert(t,n))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new po,this.st.set(e,t)),t}Tt(e){let t=this.rt.get(e);return t||(t=new Fs(zi),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||_i("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Et(e)}dt(e){this.st.set(e,new po),this.nt.getRemoteKeysForTarget(e).forEach((t=>{this.ct(e,t,null)}))}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function mo(){return new xs(ps.comparator)}function yo(){return new xs(ps.comparator)}const vo={asc:"ASCENDING",desc:"DESCENDING"},wo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Eo{constructor(e,t){this.databaseId=e,this.N=t}}function Io(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function To(e,t){return e.N?t.toBase64():t.toUint8Array()}function bo(e,t){return Io(e,t.toTimestamp())}function _o(e){return Ni(!!e),Gi.fromTimestamp(function(e){const t=ss(e);return new $i(t.seconds,t.nanos)}(e))}function So(e,t){return function(e){return new Ji(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function ko(e){const t=Ji.fromString(e);return Ni(zo(t)),t}function Co(e,t){return So(e.databaseId,t.path)}function Ao(e,t){const n=ko(t);if(n.get(1)!==e.databaseId.projectId)throw new Oi(Di.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Oi(Di.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ps(Do(n))}function No(e,t){return So(e.databaseId,t)}function Ro(e){return new Ji(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Do(e){return Ni(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oo(e,t,n){return{name:Co(e,t),fields:n.value.mapValue.fields}}function Lo(e,t){return{documents:[No(e,t.path)]}}function Po(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=No(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=No(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(ks(e.value))return{unaryFilter:{field:Fo(e.field),op:"IS_NAN"}};if(Ss(e.value))return{unaryFilter:{field:Fo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ks(e.value))return{unaryFilter:{field:Fo(e.field),op:"IS_NOT_NAN"}};if(Ss(e.value))return{unaryFilter:{field:Fo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fo(e.field),op:Vo(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);s&&(n.structuredQuery.where=s);const r=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Fo(e.field),direction:Uo(e.dir)}}(e)))}(t.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(e,t){return e.N||ds(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Mo(e){let t=function(e){const t=ko(e);return 4===t.length?Ji.emptyPath():Do(t)}(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){Ni(1===i);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=xo(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new nr(Bo(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,ds(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new tr(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new tr(n,t)}(n.endAt)),function(e,t,n,i,s,r,o,a){return new or(e,t,n,i,s,r,o,a)}(t,s,o,r,a,"F",c,u)}function xo(e){return e?void 0!==e.unaryFilter?[qo(e)]:void 0!==e.fieldFilter?[jo(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>xo(e))).reduce(((e,t)=>e.concat(t))):Ai():[]}function Uo(e){return vo[e]}function Vo(e){return wo[e]}function Fo(e){return{fieldPath:e.canonicalString()}}function Bo(e){return es.fromServerFormat(e.fieldPath)}function jo(e){return $s.create(Bo(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ai()}}(e.fieldFilter.op),e.fieldFilter.value)}function qo(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Bo(e.unaryFilter.field);return $s.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Bo(e.unaryFilter.field);return $s.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Bo(e.unaryFilter.field);return $s.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Bo(e.unaryFilter.field);return $s.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Ai()}}function Ko(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function zo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Ho{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ai(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ho(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ho?t:Ho.resolve(t)}catch(e){return Ho.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ho.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ho.reject(t)}static resolve(e){return new Ho(((t,n)=>{t(e)}))}static reject(e){return new Ho(((t,n)=>{n(e)}))}static waitFor(e){return new Ho(((t,n)=>{let i=0,s=0,r=!1;e.forEach((e=>{++i,e.next((()=>{++s,r&&s===i&&t()}),(e=>n(e)))})),r=!0,s===i&&t()}))}static or(e){let t=Ho.resolve(!1);for(const n of e)t=t.next((e=>e?Ho.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}}function $o(e){return"IndexedDbTransactionError"===e.name}class Go{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&Mr(i,e,n[t])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&xr(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&xr(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),i=n;this.applyToLocalView(i),n.isValidDocument()||i.convertToNoDocument(Gi.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ro())}isEqual(e){return this.batchId===e.batchId&&Hi(this.mutations,e.mutations,((e,t)=>Vr(e,t)))&&Hi(this.baseMutations,e.baseMutations,((e,t)=>Vr(e,t)))}}class Wo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Ni(e.mutations.length===n.length);let i=io;const s=e.mutations;for(let e=0;e<s.length;e++)i=i.insert(s[e].key,n[e].version);return new Wo(e,t,n,i)}}class Xo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Yo{constructor(e,t,n,i,s=Gi.min(),r=Gi.min(),o=ns.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(e){return new Yo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Yo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Yo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Qo{constructor(e){this.Jt=e}}function Jo(e){const t=Mo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?function(e,t,n){return new or(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}(t,t.limit,"L"):t}class Zo{constructor(){}Zt(e,t){this.te(e,t),t.ee()}te(e,t){if("nullValue"in e)this.ne(t,5);else if("booleanValue"in e)this.ne(t,10),t.se(e.booleanValue?1:0);else if("integerValue"in e)this.ne(t,15),t.se(rs(e.integerValue));else if("doubleValue"in e){const n=rs(e.doubleValue);isNaN(n)?this.ne(t,13):(this.ne(t,15),fs(n)?t.se(0):t.se(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ne(t,20),"string"==typeof n?t.ie(n):(t.ie(`${n.seconds||""}`),t.se(n.nanos||0))}else if("stringValue"in e)this.re(e.stringValue,t),this.oe(t);else if("bytesValue"in e)this.ne(t,30),t.ue(os(e.bytesValue)),this.oe(t);else if("referenceValue"in e)this.ae(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ne(t,45),t.se(n.latitude||0),t.se(n.longitude||0)}else"mapValue"in e?Ns(e)?this.ne(t,Number.MAX_SAFE_INTEGER):(this.ce(e.mapValue,t),this.oe(t)):"arrayValue"in e?(this.he(e.arrayValue,t),this.oe(t)):Ai()}re(e,t){this.ne(t,25),this.le(e,t)}le(e,t){t.ie(e)}ce(e,t){const n=e.fields||{};this.ne(t,55);for(const e of Object.keys(n))this.re(e,t),this.te(n[e],t)}he(e,t){const n=e.values||[];this.ne(t,50);for(const e of n)this.te(e,t)}ae(e,t){this.ne(t,37),ps.fromName(e).path.forEach((e=>{this.ne(t,60),this.le(e,t)}))}ne(e,t){e.se(t)}oe(e){e.se(2)}}Zo.fe=new Zo;class ea{constructor(){this.qe=new ta}addToCollectionParentIndex(e,t){return this.qe.add(t),Ho.resolve()}getCollectionParents(e,t){return Ho.resolve(this.qe.getEntries(t))}addFieldIndex(e,t){return Ho.resolve()}deleteFieldIndex(e,t){return Ho.resolve()}getDocumentsMatchingTarget(e,t){return Ho.resolve(null)}getIndexType(e,t){return Ho.resolve(0)}getFieldIndexes(e,t){return Ho.resolve([])}getNextCollectionGroupToUpdate(e){return Ho.resolve(null)}getMinOffset(e,t){return Ho.resolve(Ps.min())}updateCollectionGroup(e,t,n){return Ho.resolve()}updateIndexEntries(e,t){return Ho.resolve()}}class ta{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Fs(Ji.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Fs(Ji.comparator)).toArray()}}new Uint8Array(0);class na{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new na(e,na.DEFAULT_COLLECTION_PERCENTILE,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}na.DEFAULT_COLLECTION_PERCENTILE=10,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,na.DEFAULT=new na(41943040,na.DEFAULT_COLLECTION_PERCENTILE,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),na.DISABLED=new na(-1,0,0);class ia{constructor(e){this.mn=e}next(){return this.mn+=2,this.mn}static gn(){return new ia(0)}static yn(){return new ia(-1)}}async function sa(e){if(e.code!==Di.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;_i("LocalStore","Unexpectedly lost primary lease")}class ra{constructor(e,t,n){this.ds=e,this.Bs=t,this.indexManager=n}Ls(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.Us(e,t,n)))}Us(e,t,n){return this.ds.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}qs(e,t){e.forEach(((e,n)=>{for(const e of t)e.applyToLocalView(n)}))}Ks(e,t){return this.ds.getEntries(e,t).next((t=>this.Gs(e,t).next((()=>t))))}Gs(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.qs(t,e)))}Qs(e,t,n){return function(e){return ps.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.js(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.Ws(e,t,n):this.zs(e,t,n)}js(e,t){return this.Ls(e,new ps(t)).next((e=>{let t=to();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Ws(e,t,n){const i=t.collectionGroup;let s=to();return this.indexManager.getCollectionParents(e,i).next((r=>Ho.forEach(r,(r=>{const o=function(e,t){return new or(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,r.child(i));return this.zs(e,o,n).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}zs(e,t,n){let i;return this.ds.getAllFromCollection(e,t.path,n).next((n=>(i=n,this.Bs.getAllMutationBatchesAffectingQuery(e,t)))).next((e=>{for(const t of e)for(const e of t.mutations){const n=e.key;let s=i.get(n);null==s&&(s=Os.newInvalidDocument(n),i=i.insert(n,s)),xr(e,s,t.localWriteTime),s.isFoundDocument()||(i=i.remove(n))}})).next((()=>(i.forEach(((e,n)=>{fr(t,n)||(i=i.remove(e))})),i)))}}class oa{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Hs=n,this.Js=i}static Ys(e,t){let n=ro(),i=ro();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new oa(e,t.fromCache,n,i)}}class aa{constructor(){this.Xs=!1}initialize(e,t){this.Zs=e,this.indexManager=t,this.Xs=!0}Qs(e,t,n,i){return this.ti(e,t).next((s=>s||this.ei(e,t,i,n))).next((n=>n||this.ni(e,t)))}ti(e,t){return Ho.resolve(null)}ei(e,t,n,i){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||i.isEqual(Gi.min())?this.ni(e,t):this.Zs.Ks(e,n).next((s=>{const r=this.si(t,s);return this.ii(t,r,n,i)?this.ni(e,t):(bi()<=a.in.DEBUG&&_i("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),dr(t)),this.ri(e,r,t,function(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=Gi.fromTimestamp(1e9===i?new $i(n+1,0):new $i(n,i));return new Ps(s,ps.empty(),t)}(i,-1)))}))}si(e,t){let n=new Fs(pr(e));return t.forEach(((t,i)=>{fr(e,i)&&(n=n.add(i))})),n}ii(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ni(e,t){return bi()<=a.in.DEBUG&&_i("QueryEngine","Using full collection scan to execute query:",dr(t)),this.Zs.Qs(e,t,Ps.min())}ri(e,t,n,i){return this.Zs.Qs(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class ca{constructor(e,t,n,i){this.persistence=e,this.oi=t,this.M=i,this.ui=new xs(zi),this.ai=new Qr((e=>Ks(e)),zs),this.ci=new Map,this.hi=e.getRemoteDocumentCache(),this.fs=e.getTargetCache(),this._s=e.getBundleCache(),this.li(n)}li(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.fi=new ra(this.hi,this.Bs,this.indexManager),this.hi.setIndexManager(this.indexManager),this.oi.initialize(this.fi,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ui)))}}async function ua(e,t){const n=Ri(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.Bs.getAllMutationBatches(e).next((s=>(i=s,n.li(t),n.Bs.getAllMutationBatches(e)))).next((t=>{const s=[],r=[];let o=ro();for(const e of i){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.fi.Ks(e,o).next((e=>({di:e,removedBatchIds:s,addedBatchIds:r})))}))}))}function ha(e){const t=Ri(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.fs.getLastRemoteSnapshotVersion(e)))}function la(e,t){const n=Ri(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.Bs.getNextMutationBatchAfterBatchId(e,t))))}async function da(e,t,n){const i=Ri(e),s=i.ui.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(e=>i.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!$o(e))throw e;_i("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.ui=i.ui.remove(t),i.ai.delete(s.target)}function fa(e,t,n){const i=Ri(e);let s=Gi.min(),r=ro();return i.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const i=Ri(e),s=i.ai.get(n);return void 0!==s?Ho.resolve(i.ui.get(s)):i.fs.getTargetData(t,n)}(i,e,ur(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.fs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>i.oi.Qs(e,t,n?s:Gi.min(),n?r:ro()))).next((e=>(function(e,t,n){let i=Gi.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.ci.set(t,i)}(i,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,_i:r})))))}class pa{constructor(e){this.M=e,this.yi=new Map,this.pi=new Map}getBundleMetadata(e,t){return Ho.resolve(this.yi.get(t))}saveBundleMetadata(e,t){var n;return this.yi.set(t.id,{id:(n=t).id,version:n.version,createTime:_o(n.createTime)}),Ho.resolve()}getNamedQuery(e,t){return Ho.resolve(this.pi.get(t))}saveNamedQuery(e,t){return this.pi.set(t.name,function(e){return{name:e.name,query:Jo(e.bundledQuery),readTime:_o(e.readTime)}}(t)),Ho.resolve()}}class ga{constructor(){this.overlays=new xs(ps.comparator),this.Ii=new Map}getOverlay(e,t){return Ho.resolve(this.overlays.get(t))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.Xt(e,t,i)})),Ho.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ii.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ii.delete(n)),Ho.resolve()}getOverlaysForCollection(e,t,n){const i=no(),s=t.length+1,r=new ps(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Ho.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new xs(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=no(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=no(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return Ho.resolve(o)}Xt(e,t,n){if(null===n)return;const i=this.overlays.get(n.key);if(null!==i){const e=this.Ii.get(i.largestBatchId).delete(n.key);this.Ii.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Xo(t,n));let s=this.Ii.get(t);void 0===s&&(s=ro(),this.Ii.set(t,s)),this.Ii.set(t,s.add(n.key))}}class ma{constructor(){this.Ti=new Fs(ya.Ei),this.Ai=new Fs(ya.Ri)}isEmpty(){return this.Ti.isEmpty()}addReference(e,t){const n=new ya(e,t);this.Ti=this.Ti.add(n),this.Ai=this.Ai.add(n)}bi(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Pi(new ya(e,t))}Vi(e,t){e.forEach((e=>this.removeReference(e,t)))}vi(e){const t=new ps(new Ji([])),n=new ya(t,e),i=new ya(t,e+1),s=[];return this.Ai.forEachInRange([n,i],(e=>{this.Pi(e),s.push(e.key)})),s}Si(){this.Ti.forEach((e=>this.Pi(e)))}Pi(e){this.Ti=this.Ti.delete(e),this.Ai=this.Ai.delete(e)}Di(e){const t=new ps(new Ji([])),n=new ya(t,e),i=new ya(t,e+1);let s=ro();return this.Ai.forEachInRange([n,i],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new ya(e,0),n=this.Ti.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ya{constructor(e,t){this.key=e,this.Ci=t}static Ei(e,t){return ps.comparator(e.key,t.key)||zi(e.Ci,t.Ci)}static Ri(e,t){return zi(e.Ci,t.Ci)||ps.comparator(e.key,t.key)}}class va{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.Bs=[],this.xi=1,this.Ni=new Fs(ya.Ei)}checkEmpty(e){return Ho.resolve(0===this.Bs.length)}addMutationBatch(e,t,n,i){const s=this.xi;this.xi++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const r=new Go(s,t,n,i);this.Bs.push(r);for(const t of i)this.Ni=this.Ni.add(new ya(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ho.resolve(r)}lookupMutationBatch(e,t){return Ho.resolve(this.ki(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.Mi(n),s=i<0?0:i;return Ho.resolve(this.Bs.length>s?this.Bs[s]:null)}getHighestUnacknowledgedBatchId(){return Ho.resolve(0===this.Bs.length?-1:this.xi-1)}getAllMutationBatches(e){return Ho.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ya(t,0),i=new ya(t,Number.POSITIVE_INFINITY),s=[];return this.Ni.forEachInRange([n,i],(e=>{const t=this.ki(e.Ci);s.push(t)})),Ho.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fs(zi);return t.forEach((e=>{const t=new ya(e,0),i=new ya(e,Number.POSITIVE_INFINITY);this.Ni.forEachInRange([t,i],(e=>{n=n.add(e.Ci)}))})),Ho.resolve(this.Oi(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;ps.isDocumentKey(s)||(s=s.child(""));const r=new ya(new ps(s),0);let o=new Fs(zi);return this.Ni.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Ci)),!0)}),r),Ho.resolve(this.Oi(o))}Oi(e){const t=[];return e.forEach((e=>{const n=this.ki(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ni(0===this.Fi(t.batchId,"removed")),this.Bs.shift();let n=this.Ni;return Ho.forEach(t.mutations,(i=>{const s=new ya(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Ni=n}))}_n(e){}containsKey(e,t){const n=new ya(t,0),i=this.Ni.firstAfterOrEqual(n);return Ho.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.Bs.length,Ho.resolve()}Fi(e,t){return this.Mi(e)}Mi(e){return 0===this.Bs.length?0:e-this.Bs[0].batchId}ki(e){const t=this.Mi(e);return t<0||t>=this.Bs.length?null:this.Bs[t]}}class wa{constructor(e){this.$i=e,this.docs=new xs(ps.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.$i(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ho.resolve(n?n.document.mutableCopy():Os.newInvalidDocument(t))}getEntries(e,t){let n=Zr();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Os.newInvalidDocument(e))})),Ho.resolve(n)}getAllFromCollection(e,t,n){let i=Zr();const s=new ps(t.child("")),r=this.docs.getIteratorFrom(s);for(;r.hasNext();){const{key:e,value:{document:s}}=r.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Ms(Ls(s),n)<=0||(i=i.insert(s.key,s.mutableCopy()))}return Ho.resolve(i)}getAllFromCollectionGroup(e,t,n,i){Ai()}Bi(e,t){return Ho.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Ea(this)}getSize(e){return Ho.resolve(this.size)}}class Ea extends class{constructor(){this.changes=new Qr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Os.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ho.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.Kn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Kn.addEntry(e,i)):this.Kn.removeEntry(n)})),Ho.waitFor(t)}getFromCache(e,t){return this.Kn.getEntry(e,t)}getAllFromCache(e,t){return this.Kn.getEntries(e,t)}}class Ia{constructor(e){this.persistence=e,this.Li=new Qr((e=>Ks(e)),zs),this.lastRemoteSnapshotVersion=Gi.min(),this.highestTargetId=0,this.Ui=0,this.qi=new ma,this.targetCount=0,this.Ki=ia.gn()}forEachTarget(e,t){return this.Li.forEach(((e,n)=>t(n))),Ho.resolve()}getLastRemoteSnapshotVersion(e){return Ho.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ho.resolve(this.Ui)}allocateTargetId(e){return this.highestTargetId=this.Ki.next(),Ho.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ui&&(this.Ui=t),Ho.resolve()}Tn(e){this.Li.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ki=new ia(t),this.highestTargetId=t),e.sequenceNumber>this.Ui&&(this.Ui=e.sequenceNumber)}addTargetData(e,t){return this.Tn(t),this.targetCount+=1,Ho.resolve()}updateTargetData(e,t){return this.Tn(t),Ho.resolve()}removeTargetData(e,t){return this.Li.delete(t.target),this.qi.vi(t.targetId),this.targetCount-=1,Ho.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Li.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Li.delete(r),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Ho.waitFor(s).next((()=>i))}getTargetCount(e){return Ho.resolve(this.targetCount)}getTargetData(e,t){const n=this.Li.get(t)||null;return Ho.resolve(n)}addMatchingKeys(e,t,n){return this.qi.bi(t,n),Ho.resolve()}removeMatchingKeys(e,t,n){this.qi.Vi(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((t=>{s.push(i.markPotentiallyOrphaned(e,t))})),Ho.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.qi.vi(t),Ho.resolve()}getMatchingKeysForTargetId(e,t){const n=this.qi.Di(t);return Ho.resolve(n)}containsKey(e,t){return Ho.resolve(this.qi.containsKey(t))}}class Ta{constructor(e,t){this.Gi={},this.overlays={},this.es=new ji(0),this.ns=!1,this.ns=!0,this.referenceDelegate=e(this),this.fs=new Ia(this),this.indexManager=new ea,this.ds=function(e){return new wa(e)}((e=>this.referenceDelegate.Qi(e))),this.M=new Qo(t),this._s=new pa(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ga,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Gi[e.toKey()];return n||(n=new va(t,this.referenceDelegate),this.Gi[e.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(e,t,n){_i("MemoryPersistence","Starting transaction:",e);const i=new ba(this.es.next());return this.referenceDelegate.ji(),n(i).next((e=>this.referenceDelegate.Wi(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}zi(e,t){return Ho.or(Object.values(this.Gi).map((n=>()=>n.containsKey(e,t))))}}class ba extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}{constructor(e){super(),this.currentSequenceNumber=e}}class _a{constructor(e){this.persistence=e,this.Hi=new ma,this.Ji=null}static Yi(e){return new _a(e)}get Xi(){if(this.Ji)return this.Ji;throw Ai()}addReference(e,t,n){return this.Hi.addReference(n,t),this.Xi.delete(n.toString()),Ho.resolve()}removeReference(e,t,n){return this.Hi.removeReference(n,t),this.Xi.add(n.toString()),Ho.resolve()}markPotentiallyOrphaned(e,t){return this.Xi.add(t.toString()),Ho.resolve()}removeTarget(e,t){this.Hi.vi(t.targetId).forEach((e=>this.Xi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ji(){this.Ji=new Set}Wi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ho.forEach(this.Xi,(n=>{const i=ps.fromPath(n);return this.Zi(e,i).next((e=>{e||t.removeEntry(i,Gi.min())}))})).next((()=>(this.Ji=null,t.apply(e))))}updateLimboDocument(e,t){return this.Zi(e,t).next((e=>{e?this.Xi.delete(t.toString()):this.Xi.add(t.toString())}))}Qi(e){return 0}Zi(e,t){return Ho.or([()=>Ho.resolve(this.Hi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.zi(e,t)])}}class Sa{constructor(){this.activeTargetIds=ao()}nr(e){this.activeTargetIds=this.activeTargetIds.add(e)}sr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}er(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ka{constructor(){this.Ur=new Sa,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ur.nr(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Ur.sr(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new Sa,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ca{Kr(e){}shutdown(){}}class Aa{constructor(){this.Gr=()=>this.Qr(),this.jr=()=>this.Wr(),this.zr=[],this.Hr()}Kr(e){this.zr.push(e)}shutdown(){window.removeEventListener("online",this.Gr),window.removeEventListener("offline",this.jr)}Hr(){window.addEventListener("online",this.Gr),window.addEventListener("offline",this.jr)}Qr(){_i("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.zr)e(0)}Wr(){_i("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.zr)e(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Na={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ra{constructor(e){this.Jr=e.Jr,this.Yr=e.Yr}Xr(e){this.Zr=e}eo(e){this.no=e}onMessage(e){this.so=e}close(){this.Yr()}send(e){this.Jr(e)}io(){this.Zr()}ro(e){this.no(e)}oo(e){this.so(e)}}class Da extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.uo=t+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(e,t,n,i,s){const r=this.ho(e,t);_i("RestConnection","Sending: ",r,n);const o={};return this.lo(o,i,s),this.fo(e,r,o,n).then((e=>(_i("RestConnection","Received: ",e),e)),(t=>{throw ki("RestConnection",`${e} failed with error: `,t,"url: ",r,"request:",n),t}))}_o(e,t,n,i,s){return this.co(e,t,n,i,s)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ii,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=Na[e];return`${this.uo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,i){return new Promise(((s,r)=>{const o=new vi;o.listenOnce(fi.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case di.NO_ERROR:const t=o.getResponseJson();_i("Connection","XHR received:",JSON.stringify(t)),s(t);break;case di.TIMEOUT:_i("Connection",'RPC "'+e+'" timed out'),r(new Oi(Di.DEADLINE_EXCEEDED,"Request time out"));break;case di.HTTP_ERROR:const n=o.getStatus();if(_i("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Di).indexOf(t)>=0?t:Di.UNKNOWN}(e.status);r(new Oi(t,e.message))}else r(new Oi(Di.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Oi(Di.UNAVAILABLE,"Connection failed."));break;default:Ai()}}finally{_i("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(i);o.send(t,"POST",a,n,15)}))}wo(e,t,n){const i=[this.uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=hi(),r=li(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new mi({})),this.lo(o.initMessageHeaders,t,n),(0,c.uI)()||(0,c.b$)()||(0,c.d)()||(0,c.w1)()||(0,c.Mn)()||(0,c.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=i.join("");_i("Connection","Creating WebChannel: "+a,o);const u=s.createWebChannel(a,o);let h=!1,l=!1;const d=new Ra({Jr:e=>{l?_i("Connection","Not sending because WebChannel is closed:",e):(h||(_i("Connection","Opening WebChannel transport."),u.open(),h=!0),_i("Connection","WebChannel sending:",e),u.send(e))},Yr:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,yi.EventType.OPEN,(()=>{l||_i("Connection","WebChannel transport opened.")})),f(u,yi.EventType.CLOSE,(()=>{l||(l=!0,_i("Connection","WebChannel transport closed"),d.ro())})),f(u,yi.EventType.ERROR,(e=>{l||(l=!0,ki("Connection","WebChannel transport errored:",e),d.ro(new Oi(Di.UNAVAILABLE,"The operation could not be completed")))})),f(u,yi.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];Ni(!!n);const i=n,s=i.error||(null===(t=i[0])||void 0===t?void 0:t.error);if(s){_i("Connection","WebChannel received error:",s);const e=s.status;let t=function(e){const t=Wr[e];if(void 0!==t)return Yr(t)}(e),n=s.message;void 0===t&&(t=Di.INTERNAL,n="Unknown error status: "+e+" with message "+s.message),l=!0,d.ro(new Oi(t,n)),u.close()}else _i("Connection","WebChannel received:",n),d.oo(n)}})),f(r,pi.STAT_EVENT,(e=>{e.stat===gi.PROXY?_i("Connection","Detected buffering proxy"):e.stat===gi.NOPROXY&&_i("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.io()}),0),d}}function Oa(){return"undefined"!=typeof document?document:null}function La(e){return new Eo(e,!0)}class Pa{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Yn=e,this.timerId=t,this.mo=n,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-n);i>0&&_i("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Yn.enqueueAfterDelay(this.timerId,i,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Ma{constructor(e,t,n,i,s,r,o,a){this.Yn=e,this.Vo=n,this.vo=i,this.So=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new Pa(e,t)}ko(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Mo()&&null===this.Co&&(this.Co=this.Yn.enqueueAfterDelay(this.Vo,6e4,(()=>this.Bo())))}Lo(e){this.Uo(),this.stream.send(e)}async Bo(){if(this.Mo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(e,t){this.Uo(),this.qo(),this.No.cancel(),this.Do++,4!==e?this.No.reset():t&&t.code===Di.RESOURCE_EXHAUSTED?(Si(t.toString()),Si("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):t&&t.code===Di.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Ko(),this.stream.close(),this.stream=null),this.state=e,await this.listener.eo(t)}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),t=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Do===t&&this.Qo(e,n)}),(t=>{e((()=>{const e=new Oi(Di.UNKNOWN,"Fetching auth token failed: "+t.message);return this.jo(e)}))}))}Qo(e,t){const n=this.Go(this.Do);this.stream=this.Wo(e,t),this.stream.Xr((()=>{n((()=>(this.state=2,this.xo=this.Yn.enqueueAfterDelay(this.vo,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.eo((e=>{n((()=>this.jo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.No.Ro((async()=>{this.state=0,this.start()}))}jo(e){return _i("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return t=>{this.Yn.enqueueAndForget((()=>this.Do===e?t():(_i("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xa extends Ma{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.M=s}Wo(e,t){return this.So.wo("Listen",e,t)}onMessage(e){this.No.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ai()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.N?(Ni(void 0===t||"string"==typeof t),ns.fromBase64String(t||"")):(Ni(void 0===t||t instanceof Uint8Array),ns.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Di.UNKNOWN:Yr(e.code);return new Oi(t,e.message||"")}(o);n=new fo(i,s,r,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=Ao(e,i.document.name),r=_o(i.document.updateTime),o=new Rs({mapValue:{fields:i.document.fields}}),a=Os.newFoundDocument(s,r,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new ho(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=Ao(e,i.document),r=i.readTime?_o(i.readTime):Gi.min(),o=Os.newNoDocument(s,r),a=i.removedTargetIds||[];n=new ho([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=Ao(e,i.document),r=i.removedTargetIds||[];n=new ho([],r,s,null)}else{if(!("filter"in t))return Ai();{t.filter;const e=t.filter;e.targetId;const i=e.count||0,s=new Gr(i),r=e.targetId;n=new lo(r,s)}}return n}(this.M,e),n=function(e){if(!("targetChange"in e))return Gi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Gi.min():t.readTime?_o(t.readTime):Gi.min()}(e);return this.listener.zo(t,n)}Ho(e){const t={};t.database=Ro(this.M),t.addTarget=function(e,t){let n;const i=t.target;return n=Hs(i)?{documents:Lo(e,i)}:{query:Po(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=To(e,t.resumeToken):t.snapshotVersion.compareTo(Gi.min())>0&&(n.readTime=Io(e,t.snapshotVersion.toTimestamp())),n}(this.M,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ai()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.M,e);n&&(t.labels=n),this.Lo(t)}Jo(e){const t={};t.database=Ro(this.M),t.removeTarget=e,this.Lo(t)}}class Ua extends Ma{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.M=s,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,t){return this.So.wo("Write",e,t)}onMessage(e){if(Ni(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const t=function(e,t){return e&&e.length>0?(Ni(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?_o(e.updateTime):_o(t);return n.isEqual(Gi.min())&&(n=_o(t)),new Dr(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=_o(e.commitTime);return this.listener.tu(n,t)}return Ni(!e.writeResults||0===e.writeResults.length),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=Ro(this.M),this.Lo(e)}Zo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof Br)n={update:Oo(e,t.key,t.value)};else if(t instanceof Hr)n={delete:Co(e,t.key)};else if(t instanceof jr)n={update:Oo(e,t.key,t.data),updateMask:Ko(t.fieldMask)};else{if(!(t instanceof $r))return Ai();n={verify:Co(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof br)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof _r)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof kr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ar)return{fieldPath:t.field.canonicalString(),increment:n.k};throw Ai()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:bo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ai()}(e,t.precondition)),n}(this.M,e)))};this.Lo(t)}}class Va extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.So=n,this.M=i,this.su=!1}iu(){if(this.su)throw new Oi(Di.FAILED_PRECONDITION,"The client has already been terminated.")}co(e,t,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.So.co(e,t,n,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Oi(Di.UNKNOWN,e.toString())}))}_o(e,t,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.So._o(e,t,n,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Oi(Di.UNKNOWN,e.toString())}))}terminate(){this.su=!0}}class Fa{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}au(){0===this.ru&&(this.cu("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}lu(e){"Online"===this.state?this.cu("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.fu(),this.ru=0,"Online"===e&&(this.uu=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(Si(t),this.uu=!1):_i("OnlineStateTracker",t)}fu(){null!==this.ou&&(this.ou.cancel(),this.ou=null)}}class Ba{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=s,this.gu.Kr((e=>{n.enqueueAndForget((async()=>{Xa(this)&&(_i("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ri(e);t.wu.add(4),await qa(t),t.yu.set("Unknown"),t.wu.delete(4),await ja(t)}(this))}))})),this.yu=new Fa(n,i)}}async function ja(e){if(Xa(e))for(const t of e.mu)await t(!0)}async function qa(e){for(const t of e.mu)await t(!1)}function Ka(e,t){const n=Ri(e);n._u.has(t.targetId)||(n._u.set(t.targetId,t),Wa(n)?Ga(n):dc(n).Mo()&&Ha(n,t))}function za(e,t){const n=Ri(e),i=dc(n);n._u.delete(t),i.Mo()&&$a(n,t),0===n._u.size&&(i.Mo()?i.$o():Xa(n)&&n.yu.set("Unknown"))}function Ha(e,t){e.pu.Z(t.targetId),dc(e).Ho(t)}function $a(e,t){e.pu.Z(t),dc(e).Jo(t)}function Ga(e){e.pu=new go({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e._u.get(t)||null}),dc(e).start(),e.yu.au()}function Wa(e){return Xa(e)&&!dc(e).ko()&&e._u.size>0}function Xa(e){return 0===Ri(e).wu.size}function Ya(e){e.pu=void 0}async function Qa(e){e._u.forEach(((t,n)=>{Ha(e,t)}))}async function Ja(e,t){Ya(e),Wa(e)?(e.yu.lu(t),Ga(e)):e.yu.set("Unknown")}async function Za(e,t,n){if(e.yu.set("Online"),t instanceof fo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e._u.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e._u.delete(i),e.pu.removeTarget(i))}(e,t)}catch(n){_i("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ec(e,n)}else if(t instanceof ho?e.pu.ut(t):t instanceof lo?e.pu._t(t):e.pu.ht(t),!n.isEqual(Gi.min()))try{const t=await ha(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.pu.yt(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e._u.get(i);s&&e._u.set(i,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e._u.get(t);if(!n)return;e._u.set(t,n.withResumeToken(ns.EMPTY_BYTE_STRING,n.snapshotVersion)),$a(e,t);const i=new Yo(n.target,t,1,n.sequenceNumber);Ha(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){_i("RemoteStore","Failed to raise snapshot:",t),await ec(e,t)}}async function ec(e,t,n){if(!$o(t))throw t;e.wu.add(1),await qa(e),e.yu.set("Offline"),n||(n=()=>ha(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{_i("RemoteStore","Retrying IndexedDB access"),await n(),e.wu.delete(1),await ja(e)}))}function tc(e,t){return t().catch((n=>ec(e,n,t)))}async function nc(e){const t=Ri(e),n=fc(t);let i=t.du.length>0?t.du[t.du.length-1].batchId:-1;for(;ic(t);)try{const e=await la(t.localStore,i);if(null===e){0===t.du.length&&n.$o();break}i=e.batchId,sc(t,e)}catch(e){await ec(t,e)}rc(t)&&oc(t)}function ic(e){return Xa(e)&&e.du.length<10}function sc(e,t){e.du.push(t);const n=fc(e);n.Mo()&&n.Xo&&n.Zo(t.mutations)}function rc(e){return Xa(e)&&!fc(e).ko()&&e.du.length>0}function oc(e){fc(e).start()}async function ac(e){fc(e).nu()}async function cc(e){const t=fc(e);for(const n of e.du)t.Zo(n.mutations)}async function uc(e,t,n){const i=e.du.shift(),s=Wo.from(i,t,n);await tc(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await nc(e)}async function hc(e,t){t&&fc(e).Xo&&await async function(e,t){if(function(e){switch(e){default:return Ai();case Di.CANCELLED:case Di.UNKNOWN:case Di.DEADLINE_EXCEEDED:case Di.RESOURCE_EXHAUSTED:case Di.INTERNAL:case Di.UNAVAILABLE:case Di.UNAUTHENTICATED:return!1;case Di.INVALID_ARGUMENT:case Di.NOT_FOUND:case Di.ALREADY_EXISTS:case Di.PERMISSION_DENIED:case Di.FAILED_PRECONDITION:case Di.ABORTED:case Di.OUT_OF_RANGE:case Di.UNIMPLEMENTED:case Di.DATA_LOSS:return!0}}(n=t.code)&&n!==Di.ABORTED){const n=e.du.shift();fc(e).Fo(),await tc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await nc(e)}var n}(e,t),rc(e)&&oc(e)}async function lc(e,t){const n=Ri(e);n.asyncQueue.verifyOperationInProgress(),_i("RemoteStore","RemoteStore received new credentials");const i=Xa(n);n.wu.add(3),await qa(n),i&&n.yu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.wu.delete(3),await ja(n)}function dc(e){return e.Iu||(e.Iu=function(e,t,n){const i=Ri(e);return i.iu(),new xa(t,i.So,i.authCredentials,i.appCheckCredentials,i.M,n)}(e.datastore,e.asyncQueue,{Xr:Qa.bind(null,e),eo:Ja.bind(null,e),zo:Za.bind(null,e)}),e.mu.push((async t=>{t?(e.Iu.Fo(),Wa(e)?Ga(e):e.yu.set("Unknown")):(await e.Iu.stop(),Ya(e))}))),e.Iu}function fc(e){return e.Tu||(e.Tu=function(e,t,n){const i=Ri(e);return i.iu(),new Ua(t,i.So,i.authCredentials,i.appCheckCredentials,i.M,n)}(e.datastore,e.asyncQueue,{Xr:ac.bind(null,e),eo:hc.bind(null,e),eu:cc.bind(null,e),tu:uc.bind(null,e)}),e.mu.push((async t=>{t?(e.Tu.Fo(),await nc(e)):(await e.Tu.stop(),e.du.length>0&&(_i("RemoteStore",`Stopping write stream with ${e.du.length} pending writes`),e.du=[]))}))),e.Tu}class pc{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Li,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new pc(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Oi(Di.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gc(e,t){if(Si("AsyncQueue",`${t}: ${e}`),$o(e))return new Oi(Di.UNAVAILABLE,`${t}: ${e}`);throw e}class mc{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ps.comparator(t.key,n.key):(e,t)=>ps.comparator(e.key,t.key),this.keyedMap=to(),this.sortedSet=new xs(this.comparator)}static emptySet(e){return new mc(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mc))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new mc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class yc{constructor(){this.Eu=new xs(ps.comparator)}track(e){const t=e.doc.key,n=this.Eu.get(t);n?0!==e.type&&3===n.type?this.Eu=this.Eu.insert(t,e):3===e.type&&1!==n.type?this.Eu=this.Eu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Eu=this.Eu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Eu=this.Eu.remove(t):1===e.type&&2===n.type?this.Eu=this.Eu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):Ai():this.Eu=this.Eu.insert(t,e)}Au(){const e=[];return this.Eu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class vc{constructor(e,t,n,i,s,r,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new vc(e,t,mc.emptySet(t),s,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class wc{constructor(){this.Ru=void 0,this.listeners=[]}}class Ec{constructor(){this.queries=new Qr((e=>lr(e)),hr),this.onlineState="Unknown",this.bu=new Set}}function Ic(e,t){const n=Ri(e);let i=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.Vu(e)&&(i=!0);s.Ru=e}}i&&bc(n)}function Tc(e,t,n){const i=Ri(e),s=i.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);i.queries.delete(t)}function bc(e){e.bu.forEach((e=>{e.next()}))}class _c{constructor(e,t,n){this.query=e,this.vu=t,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=n||{}}Vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new vc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.Su?this.Cu(e)&&(this.vu.next(e),t=!0):this.xu(e,this.onlineState)&&(this.Nu(e),t=!0),this.Du=e,t}onError(e){this.vu.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),t=!0),t}xu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return!(this.options.ku&&n||e.docs.isEmpty()&&"Offline"!==t)}Cu(e){if(e.docChanges.length>0)return!0;const t=this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Nu(e){e=vc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Su=!0,this.vu.next(e)}}class Sc{constructor(e){this.key=e}}class kc{constructor(e){this.key=e}}class Cc{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.current=!1,this.Ku=ro(),this.mutatedKeys=ro(),this.Gu=pr(e),this.Qu=new mc(this.Gu)}get ju(){return this.Uu}Wu(e,t){const n=t?t.zu:new yc,i=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const u=i.get(e),h=fr(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Hu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Gu(h,a)>0||c&&this.Gu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),s=d?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{Qu:r,zu:n,ii:o,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Au();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ai()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const r=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==s.length||a?{snapshot:new vc(this.query,e.Qu,i,s,e.mutatedKeys,0===o,a,!1),Xu:r}:{Xu:r}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new yc,mutatedKeys:this.mutatedKeys,ii:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.Uu=this.Uu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Uu=this.Uu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=ro(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new kc(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new Sc(n))})),t}ta(e){this.Uu=e._i,this.Ku=ro();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ea(){return vc.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu)}}class Ac{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Nc{constructor(e){this.key=e,this.na=!1}}class Rc{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.sa={},this.ia=new Qr((e=>lr(e)),hr),this.ra=new Map,this.oa=new Set,this.ua=new xs(ps.comparator),this.aa=new Map,this.ca=new ma,this.ha={},this.la=new Map,this.fa=ia.yn(),this.onlineState="Unknown",this.da=void 0}get isPrimaryClient(){return!0===this.da}}async function Dc(e,t){const n=function(e){const t=Ri(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Lc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Mc.bind(null,t),t.sa.zo=Ic.bind(null,t.eventManager),t.sa.wa=Tc.bind(null,t.eventManager),t}(e);let i,s;const r=n.ia.get(t);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.ea();else{const e=await function(e,t){const n=Ri(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.fs.getTargetData(e,t).next((s=>s?(i=s,Ho.resolve(i)):n.fs.allocateTargetId(e).next((s=>(i=new Yo(t,s,0,e.currentSequenceNumber),n.fs.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.ui.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ui=n.ui.insert(e.targetId,e),n.ai.set(t,e.targetId)),e}))}(n.localStore,ur(t));n.isPrimaryClient&&Ka(n.remoteStore,e);const r=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,s=await async function(e,t,n,i){e._a=(t,n,i)=>async function(e,t,n,i){let s=t.view.Wu(n);s.ii&&(s=await fa(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,s))));const r=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,r);return qc(e,t.targetId,o.Xu),o.snapshot}(e,t,n,i);const s=await fa(e.localStore,t,!0),r=new Cc(t,s._i),o=r.Wu(s.documents),a=uo.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState),c=r.applyChanges(o,e.isPrimaryClient,a);qc(e,n,c.Xu);const u=new Ac(t,n,r);return e.ia.set(t,u),e.ra.has(n)?e.ra.get(n).push(t):e.ra.set(n,[t]),c.snapshot}(n,t,i,"current"===r)}return s}async function Oc(e,t){const n=Ri(e),i=n.ia.get(t),s=n.ra.get(i.targetId);if(s.length>1)return n.ra.set(i.targetId,s.filter((e=>!hr(e,t)))),void n.ia.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await da(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),za(n.remoteStore,i.targetId),Bc(n,i.targetId)})).catch(sa)):(Bc(n,i.targetId),await da(n.localStore,i.targetId,!0))}async function Lc(e,t){const n=Ri(e);try{const e=await function(e,t){const n=Ri(e),i=t.snapshotVersion;let s=n.ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.hi.newChangeBuffer({trackRemovals:!0});s=n.ui;const o=[];t.targetChanges.forEach(((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.fs.removeMatchingKeys(e,r.removedDocuments,a).next((()=>n.fs.addMatchingKeys(e,r.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(ns.EMPTY_BYTE_STRING,Gi.min()).withLastLimboFreeSnapshotVersion(Gi.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.fs.updateTargetData(e,u))}));let a=Zr();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(function(e,t,n){let i=ro();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=Zr();return n.forEach(((n,s)=>{const r=e.get(n);s.isNoDocument()&&s.version.isEqual(Gi.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!r.isValidDocument()||s.version.compareTo(r.version)>0||0===s.version.compareTo(r.version)&&r.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):_i("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",s.version)})),i}))}(e,r,t.documentUpdates).next((e=>{a=e}))),!i.isEqual(Gi.min())){const t=n.fs.getLastRemoteSnapshotVersion(e).next((t=>n.fs.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return Ho.waitFor(o).next((()=>r.apply(e))).next((()=>n.fi.Gs(e,a))).next((()=>a))})).then((e=>(n.ui=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.aa.get(t);i&&(Ni(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.na=!0:e.modifiedDocuments.size>0?Ni(i.na):e.removedDocuments.size>0&&(Ni(i.na),i.na=!1))})),await Hc(n,e,t)}catch(e){await sa(e)}}function Pc(e,t,n){const i=Ri(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.ia.forEach(((n,i)=>{const s=i.view.Pu(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=Ri(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Pu(t)&&(i=!0)})),i&&bc(n)}(i.eventManager,t),e.length&&i.sa.zo(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Mc(e,t,n){const i=Ri(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.aa.get(t),r=s&&s.key;if(r){let e=new xs(ps.comparator);e=e.insert(r,Os.newNoDocument(r,Gi.min()));const n=ro().add(r),s=new co(Gi.min(),new Map,new Fs(zi),e,n);await Lc(i,s),i.ua=i.ua.remove(r),i.aa.delete(t),zc(i)}else await da(i.localStore,t,!1).then((()=>Bc(i,t,n))).catch(sa)}async function xc(e,t){const n=Ri(e),i=t.batch.batchId;try{const e=await function(e,t){const n=Ri(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),s=n.hi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let o=Ho.resolve();return r.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);Ni(null!==r),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.Bs.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.fi.Ks(e,i)))}))}(n.localStore,t);Fc(n,i,null),Vc(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Hc(n,e)}catch(e){await sa(e)}}async function Uc(e,t,n){const i=Ri(e);try{const e=await function(e,t){const n=Ri(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.Bs.lookupMutationBatch(e,t).next((t=>(Ni(null!==t),i=t.keys(),n.Bs.removeMutationBatch(e,t)))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.fi.Ks(e,i)))}))}(i.localStore,t);Fc(i,t,n),Vc(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Hc(i,e)}catch(n){await sa(n)}}function Vc(e,t){(e.la.get(t)||[]).forEach((e=>{e.resolve()})),e.la.delete(t)}function Fc(e,t,n){const i=Ri(e);let s=i.ha[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.ha[i.currentUser.toKey()]=s}}function Bc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.ra.get(t))e.ia.delete(i),n&&e.sa.wa(i,n);e.ra.delete(t),e.isPrimaryClient&&e.ca.vi(t).forEach((t=>{e.ca.containsKey(t)||jc(e,t)}))}function jc(e,t){e.oa.delete(t.path.canonicalString());const n=e.ua.get(t);null!==n&&(za(e.remoteStore,n),e.ua=e.ua.remove(t),e.aa.delete(n),zc(e))}function qc(e,t,n){for(const i of n)i instanceof Sc?(e.ca.addReference(i.key,t),Kc(e,i)):i instanceof kc?(_i("SyncEngine","Document no longer in limbo: "+i.key),e.ca.removeReference(i.key,t),e.ca.containsKey(i.key)||jc(e,i.key)):Ai()}function Kc(e,t){const n=t.key,i=n.path.canonicalString();e.ua.get(n)||e.oa.has(i)||(_i("SyncEngine","New document in limbo: "+n),e.oa.add(i),zc(e))}function zc(e){for(;e.oa.size>0&&e.ua.size<e.maxConcurrentLimboResolutions;){const t=e.oa.values().next().value;e.oa.delete(t);const n=new ps(Ji.fromString(t)),i=e.fa.next();e.aa.set(i,new Nc(n)),e.ua=e.ua.insert(n,i),Ka(e.remoteStore,new Yo(ur(ar(n.path)),i,2,ji.A))}}async function Hc(e,t,n){const i=Ri(e),s=[],r=[],o=[];i.ia.isEmpty()||(i.ia.forEach(((e,a)=>{o.push(i._a(a,t,n).then((e=>{if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),s.push(e);const t=oa.Ys(a.targetId,e);r.push(t)}})))})),await Promise.all(o),i.sa.zo(s),await async function(e,t){const n=Ri(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ho.forEach(t,(t=>Ho.forEach(t.Hs,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>Ho.forEach(t.Js,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!$o(e))throw e;_i("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ui.get(t),i=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(i);n.ui=n.ui.insert(t,s)}}}(i.localStore,r))}async function $c(e,t){const n=Ri(e);if(!n.currentUser.isEqual(t)){_i("SyncEngine","User change. New user:",t.toKey());const e=await ua(n.localStore,t);n.currentUser=t,function(e,t){e.la.forEach((e=>{e.forEach((e=>{e.reject(new Oi(Di.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.la.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Hc(n,e.di)}}function Gc(e,t){const n=Ri(e),i=n.aa.get(t);if(i&&i.na)return ro().add(i.key);{let e=ro();const i=n.ra.get(t);if(!i)return e;for(const t of i){const i=n.ia.get(t);e=e.unionWith(i.view.ju)}return e}}function Wc(e){const t=Ri(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Uc.bind(null,t),t}class Xc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.M=La(e.databaseInfo.databaseId),this.sharedClientState=this.ga(e),this.persistence=this.ya(e),await this.persistence.start(),this.gcScheduler=this.pa(e),this.localStore=this.Ia(e)}pa(e){return null}Ia(e){return function(e,t,n,i){return new ca(e,t,n,i)}(this.persistence,new aa,e.initialUser,this.M)}ya(e){return new Ta(_a.Yi,this.M)}ga(e){return new ka}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Pc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=$c.bind(null,this.syncEngine),await async function(e,t){const n=Ri(e);t?(n.wu.delete(2),await ja(n)):t||(n.wu.add(2),await qa(n),n.yu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ec}createDatastore(e){const t=La(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Da(i));var i;return function(e,t,n,i){return new Va(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,s=e=>Pc(this.syncEngine,e,0),r=Aa.vt()?new Aa:new Ca,new Ba(t,n,i,s,r);var t,n,i,s,r}createSyncEngine(e,t){return function(e,t,n,i,s,r,o){const a=new Rc(e,t,n,i,s,r);return o&&(a.da=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Ri(e);_i("RemoteStore","RemoteStore shutting down."),t.wu.add(5),await qa(t),t.gu.shutdown(),t.yu.set("Unknown")}(this.remoteStore)}}class Qc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ea(this.observer.next,e)}error(e){this.observer.error?this.Ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Aa(){this.muted=!0}Ea(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Jc{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ei.UNAUTHENTICATED,this.clientId=Ki.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{_i("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(_i("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Oi(Di.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Li;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=gc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Zc(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){return e.offlineComponents||(_i("FirestoreClient","Using default OfflineComponentProvider"),await async function(e,t){e.asyncQueue.verifyOperationInProgress(),_i("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await ua(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}(e,new Xc)),e.offlineComponents}(e);_i("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener((e=>lc(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>lc(t.remoteStore,n))),e.onlineComponents=t}async function eu(e){return e.onlineComponents||(_i("FirestoreClient","Using default OnlineComponentProvider"),await Zc(e,new Yc)),e.onlineComponents}async function tu(e){const t=await eu(e),n=t.eventManager;return n.onListen=Dc.bind(null,t.syncEngine),n.onUnlisten=Oc.bind(null,t.syncEngine),n}function nu(e,t,n={}){const i=new Li;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,s){const r=new Qc({next:r=>{t.enqueueAndForget((()=>async function(e,t){const n=Ri(e),i=t.query;let s=!1;const r=n.queries.get(i);if(r){const e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}(e,o)));const a=r.docs.has(n);!a&&r.fromCache?s.reject(new Oi(Di.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&i&&"server"===i.source?s.reject(new Oi(Di.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(r)},error:e=>s.reject(e)}),o=new _c(ar(n.path),r,{includeMetadataChanges:!0,ku:!0});return async function(e,t){const n=Ri(e),i=t.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new wc),s)try{r.Ru=await n.onListen(i)}catch(e){const n=gc(e,`Initialization of query '${dr(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,r),r.listeners.push(t),t.Pu(n.onlineState),r.Ru&&t.Vu(r.Ru)&&bc(n)}(e,o)}(await tu(e),e.asyncQueue,t,n,i))),i.promise}const iu=new Map;function su(e,t,n){if(!n)throw new Oi(Di.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ru(e){if(!ps.isDocumentKey(e))throw new Oi(Di.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ou(e){if(ps.isDocumentKey(e))throw new Oi(Di.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function au(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ai()}function cu(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Oi(Di.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=au(e);throw new Oi(Di.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class uu{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Oi(Di.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Oi(Di.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,i){if(!0===t&&!0===i)throw new Oi(Di.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hu{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uu({}),this._settingsFrozen=!1,e instanceof ls?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Oi(Di.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ls(e.options.projectId)}(e))}get app(){if(!this._app)throw new Oi(Di.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Oi(Di.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uu(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Mi;switch(e.type){case"gapi":const t=e.client;return Ni(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Vi(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Oi(Di.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=iu.get(e);t&&(_i("ComponentProvider","Removing Datastore"),iu.delete(e),t.terminate())}(this),Promise.resolve()}}class lu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lu(this.firestore,e,this._key)}}class du{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new du(this.firestore,e,this._query)}}class fu extends du{constructor(e,t,n){super(e,t,ar(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new lu(this.firestore,null,new ps(e))}withConverter(e){return new fu(this.firestore,e,this._path)}}function pu(e,t,...n){if(e=(0,c.m9)(e),1===arguments.length&&(t=Ki.R()),su("doc","path",t),e instanceof hu){const i=Ji.fromString(t,...n);return ru(i),new lu(e,null,new ps(i))}{if(!(e instanceof lu||e instanceof fu))throw new Oi(Di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Ji.fromString(t,...n));return ru(i),new lu(e.firestore,e instanceof fu?e.converter:null,new ps(i))}}class gu{constructor(){this.Fa=Promise.resolve(),this.$a=[],this.Ba=!1,this.La=[],this.Ua=null,this.qa=!1,this.Ka=!1,this.Ga=[],this.No=new Pa(this,"async_queue_retry"),this.Qa=()=>{const e=Oa();e&&_i("AsyncQueue","Visibility state changed to "+e.visibilityState),this.No.Po()};const e=Oa();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Qa)}get isShuttingDown(){return this.Ba}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ja(),this.Wa(e)}enterRestrictedMode(e){if(!this.Ba){this.Ba=!0,this.Ka=e||!1;const t=Oa();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Qa)}}enqueue(e){if(this.ja(),this.Ba)return new Promise((()=>{}));const t=new Li;return this.Wa((()=>this.Ba&&this.Ka?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.$a.push(e),this.za())))}async za(){if(0!==this.$a.length){try{await this.$a[0](),this.$a.shift(),this.No.reset()}catch(e){if(!$o(e))throw e;_i("AsyncQueue","Operation failed with retryable error: "+e)}this.$a.length>0&&this.No.Ro((()=>this.za()))}}Wa(e){const t=this.Fa.then((()=>(this.qa=!0,e().catch((e=>{this.Ua=e,this.qa=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Si("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.qa=!1,e))))));return this.Fa=t,t}enqueueAfterDelay(e,t,n){this.ja(),this.Ga.indexOf(e)>-1&&(t=0);const i=pc.createAndSchedule(this,e,t,n,(e=>this.Ha(e)));return this.La.push(i),i}ja(){this.Ua&&Ai()}verifyOperationInProgress(){}async Ja(){let e;do{e=this.Fa,await e}while(e!==this.Fa)}Ya(e){for(const t of this.La)if(t.timerId===e)return!0;return!1}Xa(e){return this.Ja().then((()=>{this.La.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.La)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Ja()}))}Za(e){this.Ga.push(e)}Ha(e){const t=this.La.indexOf(e);this.La.splice(t,1)}}class mu extends hu{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new gu,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||wu(this),this._firestoreClient.terminate()}}function yu(e=(0,r.Mq)()){return(0,r.qX)(e,"firestore").getImmediate()}function vu(e){return e._firestoreClient||wu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function wu(e){var t;const n=e._freezeSettings(),i=function(e,t,n,i){return new hs(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Jc(e._authCredentials,e._appCheckCredentials,e._queue,i)}class Eu{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Oi(Di.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new es(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Iu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Iu(ns.fromBase64String(e))}catch(e){throw new Oi(Di.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Iu(ns.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Tu{constructor(e){this._methodName=e}}class bu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Oi(Di.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Oi(Di.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return zi(this._lat,e._lat)||zi(this._long,e._long)}}const _u=/^__.*__$/;class Su{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new jr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Br(e,this.data,t,this.fieldTransforms)}}function ku(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ai()}}class Cu{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.M=n,this.ignoreUndefinedProperties=i,void 0===s&&this.tc(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ec(){return this.settings.ec}nc(e){return new Cu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}sc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.nc({path:n,ic:!1});return i.rc(e),i}oc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.nc({path:n,ic:!1});return i.tc(),i}uc(e){return this.nc({path:void 0,ic:!0})}ac(e){return Vu(e,this.settings.methodName,this.settings.cc||!1,this.path,this.settings.hc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}tc(){if(this.path)for(let e=0;e<this.path.length;e++)this.rc(this.path.get(e))}rc(e){if(0===e.length)throw this.ac("Document fields must not be empty");if(ku(this.ec)&&_u.test(e))throw this.ac('Document fields cannot begin and end with "__"')}}class Au{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.M=n||La(e)}lc(e,t,n,i=!1){return new Cu({ec:e,methodName:t,hc:n,path:es.emptyPath(),ic:!1,cc:i},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function Nu(e){const t=e._freezeSettings(),n=La(e._databaseId);return new Au(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Ru(e,t,n,i,s,r={}){const o=e.lc(r.merge||r.mergeFields?2:0,t,n,s);Pu("Data must be an object, but it was:",o,i);const a=Ou(i,o);let c,u;if(r.merge)c=new ts(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=Mu(t,i,n);if(!o.contains(s))throw new Oi(Di.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Fu(e,s)||e.push(s)}c=new ts(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Su(new Rs(a),c,u)}function Du(e,t){if(Lu(e=(0,c.m9)(e)))return Pu("Unsupported field value:",t,e),Ou(e,t);if(e instanceof Tu)return function(e,t){if(!ku(t.ec))throw t.ac(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ac(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ic&&4!==t.ec)throw t.ac("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=Du(s,t.uc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vr(t.M,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=$i.fromDate(e);return{timestampValue:Io(t.M,n)}}if(e instanceof $i){const n=new $i(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Io(t.M,n)}}if(e instanceof bu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Iu)return{bytesValue:To(t.M,e._byteString)};if(e instanceof lu){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.ac(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:So(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ac(`Unsupported field value: ${au(e)}`)}(e,t)}function Ou(e,t){const n={};return Yi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Xi(e,((e,i)=>{const s=Du(i,t.sc(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function Lu(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof $i||e instanceof bu||e instanceof Iu||e instanceof lu||e instanceof Tu)}function Pu(e,t,n){if(!Lu(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=au(n);throw"an object"===i?t.ac(e+" a custom object"):t.ac(e+" "+i)}}function Mu(e,t,n){if((t=(0,c.m9)(t))instanceof Eu)return t._internalPath;if("string"==typeof t)return Uu(e,t);throw Vu("Field path arguments must be of type string or ",e,!1,void 0,n)}const xu=new RegExp("[~\\*/\\[\\]]");function Uu(e,t,n){if(t.search(xu)>=0)throw Vu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Eu(...t.split("."))._internalPath}catch(i){throw Vu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Vu(e,t,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new Oi(Di.INVALID_ARGUMENT,a+e+c)}function Fu(e,t){return e.some((e=>e.isEqual(t)))}class Bu{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new lu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ju(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(qu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ju extends Bu{data(){return super.data()}}function qu(e,t){return"string"==typeof t?Uu(e,t):t instanceof Eu?t._internalPath:t._delegate._internalPath}class Ku{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zu extends Bu{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Hu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(qu("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Hu extends zu{data(e={}){return super.data(e)}}class $u extends class{convertValue(e,t="none"){switch(ms(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(os(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ai()}}convertObject(e,t){const n={};return Xi(e.fields,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertGeoPoint(e){return new bu(rs(e.latitude),rs(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=cs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(us(e));default:return null}}convertTimestamp(e){const t=ss(e);return new $i(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ji.fromString(e);Ni(zo(n));const i=new ls(n.get(1),n.get(3)),s=new ps(n.popFirst(5));return i.isEqual(t)||Si(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new Iu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lu(this.firestore,null,t)}}function Gu(e,t){return function(e,t){const n=new Li;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=Wc(e);try{const e=await function(e,t){const n=Ri(e),i=$i.now(),s=t.reduce(((e,t)=>e.add(t.key)),ro());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.fi.Ks(e,s).next((s=>{r=s;const o=[];for(const e of t){const t=Ur(e,r.get(e.key));null!=t&&o.push(new jr(e.key,t,Ds(t.value.mapValue),Or.exists(!0)))}return n.Bs.addMutationBatch(e,i,o,t)})))).then((e=>(e.applyToLocalDocumentSet(r),{batchId:e.batchId,changes:r})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.ha[e.currentUser.toKey()];i||(i=new xs(zi)),i=i.insert(t,n),e.ha[e.currentUser.toKey()]=i}(i,e.batchId,n),await Hc(i,e.changes),await nc(i.remoteStore)}catch(e){const t=gc(e,"Failed to persist write");n.reject(t)}}(await function(e){return eu(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(vu(e),t)}!function(e,t=!0){!function(e){Ii=e}(r.Jn),(0,r.Xd)(new o.wA("firestore",((e,{options:n})=>{const i=e.getProvider("app").getImmediate(),s=new mu(i,new xi(e.getProvider("auth-internal")),new Bi(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),s._setSettings(n),s}),"PUBLIC")),(0,r.KN)(wi,"3.4.9",e),(0,r.KN)(wi,"3.4.9","esm2017")}();var Wu=n(588),Xu=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};(0,s.ZF)({apiKey:"AIzaSyCr7_Es7xBQzlXHejZukEr1ovanvYYo_Z4",authDomain:"historyorsomething-9.firebaseapp.com",projectId:"historyorsomething-9",storageBucket:"historyorsomething-9.appspot.com",messagingSenderId:"603241360494",appId:"1:603241360494:web:90f27fa38c0b46fecd4a7f"});const Yu=yu();!function(e,t,...n){if(e=(0,c.m9)(e),su("collection","path",t),e instanceof hu){const i=Ji.fromString(t,...n);return ou(i),new fu(e,null,i)}{if(!(e instanceof lu||e instanceof fu))throw new Oi(Di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Ji.fromString(t,...n));ou(i),new fu(e.firestore,null,i)}}(Yu,"quizes");let Qu=(0,Wu.v0)();class Ju{constructor(){this.db=yu(),this.userData={}}test(){console.log("database function working!")}loginUser(e,t){return Xu(this,void 0,void 0,(function*(){let n={success:!1,message:"",data:{}};Qu=(0,Wu.v0)();try{const i=yield(0,Wu.e5)(Qu,e,t);if(i){try{n.data=yield this.getData("users",i.user.uid),Ju.userLogged=!0}catch(e){}Ju.id=i.user.uid,console.log(Ju.id),n.success=!0,this.userData=n.data}}catch(e){n.message=e.message}return n}))}logoutUser(){return Xu(this,void 0,void 0,(function*(){let e=!1;const t=yield(0,Wu.w7)(Qu).then((()=>(Ju.userLogged=!0,e=!0,e)));return 1==t&&(Qu=null),console.log(t),e}))}checkUserAuth(){return null!=Qu}signUpUser(e,t){return Xu(this,void 0,void 0,(function*(){let n={success:!1,message:"",data:{}};Qu=(0,Wu.v0)();try{const i=yield(0,Wu.Xb)(Qu,e,t);let s=i.user.uid;if(i)try{yield this.setNewDoc(s);try{n.data=yield this.getData("users",s)}catch(e){}n.success=!0}catch(e){n.message=e.message}}catch(e){n.message=e.message}return n}))}setNewDoc(e){return Xu(this,void 0,void 0,(function*(){let t=!1;try{yield function(e,t,n){e=cu(e,lu);const i=cu(e.firestore,mu),s=function(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}(e.converter,t,n);return Gu(i,[Ru(Nu(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,Or.none())])}(pu(Yu,"users",e),{score:1,id:e}),t=!0}catch(e){return console.log(e),!1}return t}))}getData(e,t){return Xu(this,void 0,void 0,(function*(){const n=pu(Yu,e,t);let i=[];try{const e=yield function(e){e=cu(e,lu);const t=cu(e.firestore,mu);return nu(vu(t),e._key).then((n=>function(e,t,n){const i=n.docs.get(t._key),s=new $u(e);return new zu(e,s,t._key,i,new Ku(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}(n);i=e.data()}catch(e){console.log(e)}return i}))}}Ju.id="",Ju.userLogged=!1},444:(e,t,n)=>{n.d(t,{BH:()=>a,L:()=>r,LL:()=>v,Mn:()=>p,ZR:()=>y,b$:()=>l,d:()=>d,eu:()=>m,hl:()=>g,m9:()=>N,ne:()=>k,pd:()=>S,ru:()=>h,tV:()=>o,uI:()=>u,vZ:()=>I,w1:()=>f,xO:()=>b,xb:()=>E,z$:()=>c,zd:()=>_});const i=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],r=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(i.push(c),64!==o){const e=r<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},r=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function l(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function d(){return c().indexOf("Electron/")>=0}function f(){const e=c();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function p(){return c().indexOf("MSAppHost/")>=0}function g(){return"object"==typeof indexedDB}function m(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(w,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new y(i,o,n)}}const w=/\{\$([^}]+)}/g;function E(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function I(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(T(n)&&T(r)){if(!I(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function T(e){return null!==e&&"object"==typeof e}function b(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function _(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function S(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function k(e,t){const n=new C(e,t);return n.subscribe.bind(n)}class C{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=A),void 0===i.error&&(i.error=A),void 0===i.complete&&(i.complete=A);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function A(){}function N(e){return e&&e._delegate?e._delegate:e}},503:(e,t,n)=>{n.d(t,{ZF:()=>i.ZF});var i=n(389);(0,i.KN)("firebase","9.8.1","app")},588:(e,t,n)=>{n.d(t,{Xb:()=>Ae,v0:()=>Mt,Aj:()=>Re,e5:()=>Ne,w7:()=>De});var i=n(444),s=n(389);function r(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Object.create,Object.create;var o=n(333),a=n(463);const c=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},u=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),h=new o.Yd("@firebase/auth");function l(e,...t){h.logLevel<=o.in.ERROR&&h.error(`Auth (${s.Jn}): ${e}`,...t)}function d(e,...t){throw p(e,...t)}function f(e,...t){return p(e,...t)}function p(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return u.create(e,...t)}function g(e,t,...n){if(!e)throw p(t,...n)}function m(e){const t="INTERNAL ASSERTION FAILED: "+e;throw l(t),new Error(t)}function y(e,t){e||m(t)}const v=new Map;function w(e){y(e instanceof Function,"Expected a class definition");let t=v.get(e);return t?(y(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,v.set(e,t),t)}function E(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function I(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class T{constructor(e,t){this.shortDelay=e,this.longDelay=t,y(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===I()||"https:"===I()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function b(e,t){y(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class _{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void m("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void m("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void m("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const S={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},k=new T(3e4,6e4);function C(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,s,r={}){return N(e,r,(async()=>{let r={},o={};s&&("GET"===t?o=s:r={body:JSON.stringify(s)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),_.fetch()(D(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},r))}))}async function N(e,t,n){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},S),t);try{const t=new O(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw L(e,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const t=r.ok?o.errorMessage:o.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw L(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw L(e,"email-already-in-use",o);const u=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw function(e,t,n){const s=Object.assign(Object.assign({},c()),{[t]:n});return new i.LL("auth","Firebase",s).create(t,{appName:e.name})}(e,u,a);d(e,u)}}catch(t){if(t instanceof i.ZR)throw t;d(e,"network-request-failed")}}async function R(e,t,n,i,s={}){const r=await A(e,t,n,i,s);return"mfaPendingCredential"in r&&d(e,"multi-factor-auth-required",{_serverResponse:r}),r}function D(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?b(e.config,s):`${e.config.apiScheme}://${s}`}class O{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(f(this.auth,"network-request-failed"))),k.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function L(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=f(e,t,i);return s.customData._tokenResponse=n,s}function P(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function M(e){return 1e3*Number(e)}function x(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return l("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(l("Failed to decode base64 JWT payload"),null)}catch(e){return l("Caught error parsing JWT payload as JSON",e),null}}async function U(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class V{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class F{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=P(this.lastLoginAt),this.creationTime=P(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function B(e){var t;const n=e.auth,i=await e.getIdToken(),s=await U(e,async function(e,t){return A(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));g(null==s?void 0:s.users.length,n,"internal-error");const o=s.users[0];e._notifyReloadListener(o);const a=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?o.providerUserInfo.map((e=>{var{providerId:t}=e,n=r(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=(u=e.providerData,h=a,[...u.filter((e=>!h.some((t=>t.providerId===e.providerId)))),...h]);var u,h;const l=e.isAnonymous,d=!(e.email&&o.passwordHash||(null==c?void 0:c.length)),f=!!l&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new F(o.createdAt,o.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class j{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(void 0!==e.idToken,"internal-error"),g(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=x(e);return g(t,"internal-error"),g(void 0!==t.exp,"internal-error"),g(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return g(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:r}=await async function(e,t){const n=await N(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=e.config,o=D(e,s,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",_.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new j;return n&&(g("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(g("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(g("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new j,this.toJSON())}_performRefresh(){return m("not implemented")}}function q(e,t){g("string"==typeof e||void 0===e,"internal-error",{appName:t})}class K{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=r(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new V(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new F(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await U(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),s=await n.getIdToken(t),r=x(s);g(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:r,token:s,authTime:P(M(r.auth_time)),issuedAtTime:P(M(r.iat)),expirationTime:P(M(r.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await B(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new K(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await B(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await U(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=t.photoURL)&&void 0!==r?r:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,y=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:E,isAnonymous:I,providerData:T,stsTokenManager:b}=t;g(w&&b,e,"internal-error");const _=j.fromJSON(this.name,b);g("string"==typeof w,e,"internal-error"),q(h,e.name),q(l,e.name),g("boolean"==typeof E,e,"internal-error"),g("boolean"==typeof I,e,"internal-error"),q(d,e.name),q(f,e.name),q(p,e.name),q(m,e.name),q(y,e.name),q(v,e.name);const S=new K({uid:w,auth:e,email:l,emailVerified:E,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:y,lastLoginAt:v});return T&&Array.isArray(T)&&(S.providerData=T.map((e=>Object.assign({},e)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t,n=!1){const i=new j;i.updateFromServerResponse(t);const s=new K({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await B(s),s}}class z{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}z.type="NONE";const H=z;function $(e,t,n){return`firebase:${e}:${t}:${n}`}class G{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=$(this.userKey,i.apiKey,s),this.fullPersistenceKey=$("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?K._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new G(w(H),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||w(H);const r=$(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){const i=K._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(e){}}))),new G(s,e,n)):new G(s,e,n)}}function W(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(J(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(X(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ee(t))return"Blackberry";if(te(t))return"Webos";if(Y(t))return"Safari";if((t.includes("chrome/")||Q(t))&&!t.includes("edge/"))return"Chrome";if(Z(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function X(e=(0,i.z$)()){return/firefox\//i.test(e)}function Y(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Q(e=(0,i.z$)()){return/crios\//i.test(e)}function J(e=(0,i.z$)()){return/iemobile/i.test(e)}function Z(e=(0,i.z$)()){return/android/i.test(e)}function ee(e=(0,i.z$)()){return/blackberry/i.test(e)}function te(e=(0,i.z$)()){return/webos/i.test(e)}function ne(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)}function ie(e=(0,i.z$)()){return ne(e)||Z(e)||te(e)||ee(e)||/windows phone/i.test(e)||J(e)}function se(e,t=[]){let n;switch(e){case"Browser":n=W((0,i.z$)());break;case"Worker":n=`${W((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.Jn}/${r}`}class re{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e.message})}}}class oe{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ce(this),this.idTokenSubscription=new ce(this),this.beforeStateQueue=new re(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=w(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await G.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await B(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(w(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&w(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=await G.create(this,[w(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),r=this._isInitialized?Promise.resolve():this._initializationPromise;return g(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=se(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function ae(e){return(0,i.m9)(e)}class ce{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class ue{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return m("not implemented")}_getIdTokenResponse(e){return m("not implemented")}_linkToIdToken(e,t){return m("not implemented")}_getReauthenticationResolver(e){return m("not implemented")}}class he extends ue{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new he(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new he(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPassword",C(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return A(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function le(e,t){return R(e,"POST","/v1/accounts:signInWithIdp",C(e,t))}class de extends ue{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new de(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=r(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new de(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return le(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,le(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,le(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const fe={USER_NOT_FOUND:"user-not-found"};class pe extends ue{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new pe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new pe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await R(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t));if(n.temporaryProof)throw L(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),fe)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new pe({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class ge{constructor(e){var t,n,s,r,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(s=c.mode)&&void 0!==s?s:null);g(u&&h&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=h,this.continueUrl=null!==(r=c.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,s=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(s?(0,i.zd)((0,i.pd)(s)).link:null)||s||n||t||e}(e);try{return new ge(t)}catch(e){return null}}}class me{constructor(){this.providerId=me.PROVIDER_ID}static credential(e,t){return he._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ge.parseLink(t);return g(n,"argument-error"),he._fromEmailAndCode(e,n.code,n.tenantId)}}me.PROVIDER_ID="password",me.EMAIL_PASSWORD_SIGN_IN_METHOD="password",me.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ye{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ve extends ye{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class we extends ve{constructor(){super("facebook.com")}static credential(e){return de._fromParams({providerId:we.PROVIDER_ID,signInMethod:we.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return we.credentialFromTaggedObject(e)}static credentialFromError(e){return we.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return we.credential(e.oauthAccessToken)}catch(e){return null}}}we.FACEBOOK_SIGN_IN_METHOD="facebook.com",we.PROVIDER_ID="facebook.com";class Ee extends ve{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return de._fromParams({providerId:Ee.PROVIDER_ID,signInMethod:Ee.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ee.credentialFromTaggedObject(e)}static credentialFromError(e){return Ee.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ee.credential(t,n)}catch(e){return null}}}Ee.GOOGLE_SIGN_IN_METHOD="google.com",Ee.PROVIDER_ID="google.com";class Ie extends ve{constructor(){super("github.com")}static credential(e){return de._fromParams({providerId:Ie.PROVIDER_ID,signInMethod:Ie.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ie.credentialFromTaggedObject(e)}static credentialFromError(e){return Ie.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ie.credential(e.oauthAccessToken)}catch(e){return null}}}Ie.GITHUB_SIGN_IN_METHOD="github.com",Ie.PROVIDER_ID="github.com";class Te extends ve{constructor(){super("twitter.com")}static credential(e,t){return de._fromParams({providerId:Te.PROVIDER_ID,signInMethod:Te.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Te.credentialFromTaggedObject(e)}static credentialFromError(e){return Te.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Te.credential(t,n)}catch(e){return null}}}Te.TWITTER_SIGN_IN_METHOD="twitter.com",Te.PROVIDER_ID="twitter.com";class be{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await K._fromIdTokenResponse(e,n,i),r=_e(n);return new be({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=_e(n);return new be({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function _e(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Se extends i.ZR{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Se.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Se(e,t,n,i)}}function ke(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Se._fromErrorAndOperation(e,n,t,i);throw n}))}async function Ce(e,t,n=!1){const i="signIn",s=await ke(e,i,t),r=await be._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}async function Ae(e,t,n){const i=ae(e),s=await async function(e,t){return R(e,"POST","/v1/accounts:signUp",C(e,t))}(i,{returnSecureToken:!0,email:t,password:n}),r=await be._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(r.user),r}function Ne(e,t,n){return async function(e,t){return Ce(ae(e),t)}((0,i.m9)(e),me.credential(t,n))}function Re(e,t,n,s){return(0,i.m9)(e).onAuthStateChanged(t,n,s)}function De(e){return(0,i.m9)(e).signOut()}new WeakMap;const Oe="__sak";class Le{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Oe,"1"),this.storage.removeItem(Oe),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Pe extends Le{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return Y(e)||ne(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pe.type="LOCAL";const Me=Pe;class xe extends Le{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xe.type="SESSION";const Ue=xe;class Ve{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ve(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Fe(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Ve.receivers=[];class Be{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=Fe("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function je(){return window}function qe(){return void 0!==je().WorkerGlobalScope&&"function"==typeof je().importScripts}const Ke="firebaseLocalStorageDb",ze="firebaseLocalStorage",He="fbase_key";class $e{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ge(e,t){return e.transaction([ze],t?"readwrite":"readonly").objectStore(ze)}function We(){const e=indexedDB.open(Ke,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(ze,{keyPath:He})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(ze)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Ke);return new $e(e).toPromise()}(),t(await We()))}))}))}async function Xe(e,t,n){const i=Ge(e,!0).put({[He]:t,value:n});return new $e(i).toPromise()}function Ye(e,t){const n=Ge(e,!0).delete(t);return new $e(n).toPromise()}class Qe{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await We()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qe()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ve._getInstance(qe()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Be(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await We();return await Xe(e,Oe,"1"),await Ye(e,Oe),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Xe(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ge(e,!1).get(t),i=await new $e(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ye(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ge(e,!1).getAll();return new $e(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Qe.type="LOCAL";const Je=Qe;function Ze(e){return`__${e}${Math.floor(1e6*Math.random())}`}Ze("rcb"),new T(3e4,6e4);class et{constructor(e){this.providerId=et.PROVIDER_ID,this.auth=ae(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const s=await n.verify();try{let r;if(g("string"==typeof s,e,"argument-error"),g("recaptcha"===n.type,e,"argument-error"),r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){g("enroll"===t.type,e,"internal-error");const n=await function(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",C(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{g("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;g(n,e,"missing-multi-factor-info");const o=await function(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",C(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",C(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}(this.auth,e,(0,i.m9)(t))}static credential(e,t){return pe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return et.credentialFromTaggedObject(t)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?pe._fromTokenResponse(t,n):null}}et.PROVIDER_ID="phone",et.PHONE_SIGN_IN_METHOD="phone";class tt extends ue{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return le(e,this._buildIdpRequest())}_linkToIdToken(e,t){return le(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return le(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nt(e){return Ce(e.auth,new tt(e),e.bypassAuthState)}function it(e){const{auth:t,user:n}=e;return g(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e,s="reauthenticate";try{const r=await U(e,ke(i,s,t,e),n);g(r.idToken,i,"internal-error");const o=x(r.idToken);g(o,i,"internal-error");const{sub:a}=o;return g(e.uid===a,i,"user-mismatch"),be._forOperation(e,s,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&d(i,"user-mismatch"),e}}(n,new tt(e),e.bypassAuthState)}async function st(e){const{auth:t,user:n}=e;return g(n,t,"internal-error"),async function(e,t,n=!1){const i=await U(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return be._forOperation(e,"link",i)}(n,new tt(e),e.bypassAuthState)}class rt{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nt;case"linkViaPopup":case"linkViaRedirect":return st;case"reauthViaPopup":case"reauthViaRedirect":return it;default:d(this.auth,"internal-error")}}resolve(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ot=new T(2e3,1e4);class at extends rt{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,at.currentPopupAction&&at.currentPopupAction.cancel(),at.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return g(e,this.auth,"internal-error"),e}async onExecution(){y(1===this.filter.length,"Popup operations only handle one event");const e=Fe();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,at.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,ot.get())};e()}}at.currentPopupAction=null;const ct=new Map;class ut extends rt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ct.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return $("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return w(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ct.set(this.auth._key(),e)}return this.bypassAuthState||ct.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ht(e,t){ct.set(e._key(),t)}async function lt(e,t,n=!1){const i=ae(e),s=function(e,t){return t?w(t):(g(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),r=new ut(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class dt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!pt(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ft(e))}saveEventToCache(e){this.cachedEventUids.add(ft(e)),this.lastProcessedEventTime=Date.now()}}function ft(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function pt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const gt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mt=/^https?/;function yt(e){const t=E(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!mt.test(n))return!1;if(gt.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const vt=new T(3e4,6e4);function wt(){const e=je().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Et=null;function It(e){return Et=Et||function(e){return new Promise(((t,n)=>{var i,s,r,o;function a(){wt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{wt(),n(f(e,"network-request-failed"))},timeout:vt.get()})}if(null===(s=null===(i=je().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=je().gapi)||void 0===r?void 0:r.load)){const t=Ze("iframefcb");return je()[t]=()=>{gapi.load?a():n(f(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");var i,s;n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=f("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw Et=null,e}))}(e),Et}const Tt=new T(5e3,15e3),bt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_t=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function St(e){const t=e.config;g(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?b(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:s.Jn},o=_t.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const kt={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ct{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function At(e,t,n,r,o,a){g(e.config.authDomain,e,"auth-domain-config-required"),g(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.Jn,eventId:o};if(t instanceof ye){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof ve){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];return`${function({config:e}){return e.emulator?b(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.xO)(u).slice(1)}`}const Nt="webStorageSupport",Rt=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ue,this._completeRedirectFn=lt,this._overrideRedirectResult=ht}async _openPopup(e,t,n,s){var r;return y(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,s=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let c="";const u=Object.assign(Object.assign({},kt),{width:s.toString(),height:r.toString(),top:o,left:a}),h=(0,i.z$)().toLowerCase();n&&(c=Q(h)?"_blank":n),X(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return ne(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",c),new Ct(null);const d=window.open(t||"",c,l);g(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Ct(d)}(e,At(e,t,n,E(),s),Fe())}async _openRedirect(e,t,n,i){var s;return await this._originValidation(e),s=At(e,t,n,E(),i),je().location.href=s,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(y(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await It(e),n=je().gapi;return g(n,e,"internal-error"),t.open({where:document.body,url:St(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bt,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=f(e,"network-request-failed"),r=je().setTimeout((()=>{i(s)}),Tt.get());function o(){je().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{i(s)}))}))))}(e),n=new dt(e);return t.register("authEvent",(t=>(g(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Nt,{type:Nt},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==s&&t(!!s),d(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(yt(e))return}catch(e){}d(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ie()||Y()||ne()}};var Dt,Ot="@firebase/auth",Lt="0.20.1";class Pt{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Mt(e=(0,s.Mq)()){const t=(0,s.qX)(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=(0,s.qX)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),s=n.getOptions();if((0,i.vZ)(s,null!=t?t:{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Rt,persistence:[Je,Me,Ue]})}Dt="Browser",(0,s.Xd)(new a.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),{apiKey:s,authDomain:r}=n.options;return((e,n)=>{g(s&&!s.includes(":"),"invalid-api-key",{appName:e.name}),g(!(null==r?void 0:r.includes(":")),"argument-error",{appName:e.name});const i={apiKey:s,authDomain:r,clientPlatform:Dt,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:se(Dt)},o=new oe(e,n,i);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(w);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,s.Xd)(new a.wA("auth-internal",(e=>{return t=ae(e.getProvider("auth").getImmediate()),new Pt(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.KN)(Ot,Lt,void 0),(0,s.KN)(Ot,Lt,"esm2017")},389:(e,t,n)=>{n.d(t,{Jn:()=>P,qX:()=>D,Xd:()=>R,Mq:()=>x,ZF:()=>M,KN:()=>U});var i=n(463),s=n(333),r=n(444);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function p(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(m(this),e),g(c.get(this))}:function(...e){return g(t.apply(m(this),e))}:function(e,...n){const i=t.call(m(this),e,...n);return h.set(i,e.sort?e.sort():[e]),g(i)}:(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));u.set(e,t)}(e),n=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,f):e);var t,n}function g(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(g(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&c.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=p(e);return t!==e&&(l.set(e,t),d.set(t,e)),t}const m=e=>d.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function E(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=v.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return w.set(t,r),r}var I;I=f,f={...I,get:(e,t,n)=>E(e,t)||I.get(e,t,n),has:(e,t)=>!!E(e,t)||I.has(e,t)};class T{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const b="@firebase/app",_="0.7.24",S=new s.Yd("@firebase/app"),k={[b]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},C=new Map,A=new Map;function N(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function R(e){const t=e.name;if(A.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;A.set(t,e);for(const t of C.values())N(t,e);return!0}function D(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const O=new r.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class L{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw O.create("app-deleted",{appName:this._name})}}const P="9.8.1";function M(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},t),s=n.name;if("string"!=typeof s||!s)throw O.create("bad-app-name",{appName:String(s)});const o=C.get(s);if(o){if((0,r.vZ)(e,o.options)&&(0,r.vZ)(n,o.config))return o;throw O.create("duplicate-app",{appName:s})}const a=new i.H0(s);for(const e of A.values())a.addComponent(e);const c=new L(e,n,a);return C.set(s,c),c}function x(e="[DEFAULT]"){const t=C.get(e);if(!t)throw O.create("no-app",{appName:e});return t}function U(e,t,n){var s;let r=null!==(s=k[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);const o=r.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${r}" with version "${t}":`];return o&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}R(new i.wA(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const V="firebase-heartbeat-store";let F=null;function B(){return F||(F=function(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=g(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(g(o.result),e.oldVersion,e.newVersion,g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(V)}}).catch((e=>{throw O.create("storage-open",{originalErrorMessage:e.message})}))),F}async function j(e,t){try{const n=(await B()).transaction(V,"readwrite"),i=n.objectStore(V);return await i.put(t,q(e)),n.done}catch(e){throw O.create("storage-set",{originalErrorMessage:e.message})}}function q(e){return`${e.name}!${e.options.appId}`}class K{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new H(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=z();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=z(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),$(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),$(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,r.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function z(){return(new Date).toISOString().substring(0,10)}class H{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,r.hl)()&&(0,r.eu)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await B()).transaction(V).objectStore(V).get(q(e))}catch(e){throw O.create("storage-get",{originalErrorMessage:e.message})}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return j(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return j(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function $(e){return(0,r.L)(JSON.stringify({version:2,heartbeats:e})).length}R(new i.wA("platform-logger",(e=>new T(e)),"PRIVATE")),R(new i.wA("heartbeat",(e=>new K(e)),"PRIVATE")),U(b,_,""),U(b,_,"esm2017"),U("fire-js","")},463:(e,t,n)=>{n.d(t,{H0:()=>a,wA:()=>s});var i=n(444);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const r="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:r})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===r?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:r:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},333:(e,t,n)=>{n.d(t,{Yd:()=>u,in:()=>s});const i=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const r={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=a[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?r[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(203),t=n(503),i=n(588),s=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};(0,t.ZF)({apiKey:"AIzaSyCr7_Es7xBQzlXHejZukEr1ovanvYYo_Z4",authDomain:"historyorsomething-9.firebaseapp.com",projectId:"historyorsomething-9",storageBucket:"historyorsomething-9.appspot.com",messagingSenderId:"603241360494",appId:"1:603241360494:web:90f27fa38c0b46fecd4a7f"});let r,o=(0,i.v0)();const a=document.getElementById("user");document.addEventListener("DOMContentLoaded",(()=>s(void 0,void 0,void 0,(function*(){r=new e.x;const t=document.querySelector(".preload");t.classList.remove("preload-finish"),(0,i.Aj)(o,(e=>s(void 0,void 0,void 0,(function*(){let n=yield function(){return s(this,void 0,void 0,(function*(){let e;try{e=yield r.getData("users",window.localStorage.getItem("userId"))}catch(e){alert("Error: "+e)}return e}))}();e?(a.innerHTML='<div class="dropdown">\n  <button>Account</button>\n  <div>\n    <a href="src/Html/ComingSoon.html">Dashoard</a>\n    <a href="#">Score: '+n.score+'    </a>\n    <a id="logOut">Logout</a>\n  </div>\n</div>',t.classList.add("preload-finish"),document.getElementById("logOut").addEventListener("click",(()=>{console.log("logout Method"),r.logoutUser()&&(a.innerHTML='<a  class="nav-link" aria-current="page" href="src/Authentication/index.html"><span class="navItemStyle">Login</span></a>')}))):t.classList.add("preload-finish")}))))}))));let c=["The Mayan people worshipped turkeys like Gods.","Napoleon was once attacked by a horde of bunnies.","Cleopatra was not Egyptian, but Greek.","Pope Gregory IV declared war on cats.","In the 1830s, ketchup was sold as medicine.","Walt Disney didn't draw Mickey Mouse.","Johnny Appleseed is real.","Former U.S. President Bill Clinton lost Nuclear Launch Codes.","The dutch actually ate their prime minister.","Australia actually fought a war against its national bird ...and lost!","In Liechtenstein's last military engagement (1886),they sent in 80 soldiers. 81 came back, including a new italian friend.","Julius Caesar was stabbed 23 times.","In 1386, a pig was executed in France.","Since 1945, all British tanks are equipped with tea-making facilities.","During World War I, the French built a fake Paris.","Albert Einstein turned down the presidency of Israel.","In 1913 Stalin, Hitler, Trotsky, Tito all lived in Vienna for a couple of months.","Abraham Lincoln is in the wrestling hall of fame","In 500bc, a messenger died after he ran to athens to deliver the message, that the greeks defeated the persians.He covered a distance of 41,2km and the city he started from was named Marathon.","No one knows how much nuclear bombs the Ussr lost. In comparison, the US lost 6.","Thomas Edison didn't invent the light bulb.","Columbus wasn't the first person to discover America.","A lot of History's Disasters were caused by lack of sleep.","Before alarm clocks existed, there literally were people whose jobs was to knock an your window and wake you up for work.","Charlie Chaplin once entered a Charlie Chaplin lookalike contest  and came in 20th place."],u=Math.floor(Math.random()*c.length);document.getElementById("openForm").addEventListener("click",(()=>{u=Math.floor(Math.random()*c.length),document.getElementById("myForm").style.display="block",document.getElementById("facts").innerHTML=c[u]})),document.getElementById("highlight_close").addEventListener("click",(()=>{document.getElementById("myForm").style.display="none"})),window.addEventListener("load",(()=>{document.querySelector(".preload")}))})()})();
//# sourceMappingURL=scriptBundle.js.map